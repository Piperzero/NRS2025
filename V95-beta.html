<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NRS 2025 ASEAN Coverage Calculator</title>
  <style>
    /* ============================================
       BASE STYLES
       ============================================ */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #CDD7E3 0%, #ADC7F8 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 10px;
      box-sizing: border-box;
      margin: 0;
      flex-direction: column;
    }

    html, body {
      overflow-x: hidden;
      max-width: 100vw;
    }

    .widget-container {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      padding: 40px;
      max-width: 700px;
      width: 100%;
      margin: auto;
      position: relative;
      overflow: hidden;
    }

    /* ============================================
       LANDING PAGE STYLES
       ============================================ */
    .landing-container {
      text-align: center;
      padding: 40px 20px;
      min-height: 70vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .landing-header {
      margin-bottom: 40px;
    }

    .landing-title {
      font-size: 2.8rem;
      margin-bottom: 15px;
      background: #5A7ED8;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-weight: bold;
    }

    .landing-subtitle {
      font-size: 1.3rem;
      color: #555;
      margin-bottom: 10px;
      font-weight: 600;
    }

    .landing-tagline {
      font-size: 1rem;
      color: #666;
      margin-bottom: 30px;
    }

    .feature-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 25px;
      margin: 30px 0 40px 0;
    }

    .feature-card {
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.08);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      border: 1px solid rgba(255,255,255,0.2);
    }

    .feature-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.12);
    }

    .feature-icon {
      font-size: 2.5rem;
      margin-bottom: 12px;
    }

    .feature-title {
      font-size: 1.1rem;
      font-weight: bold;
      color: #333;
      margin-bottom: 8px;
    }

    .feature-description {
      font-size: 0.9rem;
      color: #666;
      line-height: 1.4;
    }

    .get-started-btn {
      background: #5A7ED8;
      color: white;
      border: none;
      padding: 18px 40px;
      border-radius: 30px;
      font-size: 1.2rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 6px 20px rgba(90, 126, 216, 0.3);
      margin-top: 20px;
    }

    .get-started-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
    }

    .nrs-badge {
      display: inline-block;
      background: #5A7ED8;
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 20px;
    }

    .disclaimer-section {
      margin-top: 40px;
      text-align: center;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      font-style: italic;
    }

    .disclaimer-title {
      font-size: 1.0rem;
      font-weight: bold;
      color: #333;
      margin-bottom: 20px;
      text-decoration: underline;
    }

    .disclaimer-text {
      font-size: 0.8rem;
      color: #666;
      line-height: 1.4;
      margin-bottom: 15px;
      text-align: justify;
    }

    /* ============================================
       LOGO STYLES
       ============================================ */
    .asean-logo {
      position: absolute;
      top: 7px;
      right: 30px;
      width: 120px;
      height: auto;
      z-index: 10;
    }

    .pidm-nrs2 {
      position: absolute;
      top: 28px;
      left: 20px;
      height: 40px;
      width: auto;
      z-index: 10;
    }

    /* ============================================
       PAGE & NAVIGATION STYLES
       ============================================ */
    .page {
      display: none;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .page.active {
      display: block;
      opacity: 1;
      animation: fadeIn 0.3s ease forwards;
    }

    /* Page fade-in animation */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Navigation container */
    .nav-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid #e5e7eb;
    }

    .nav-container.single-btn {
      justify-content: flex-end;
    }

    /* Navigation buttons */
    .nav-btn {
      padding: 14px 28px;
      border-radius: 25px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .nav-btn-back {
      background: #6c757d;
      color: white;
      box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
    }

    .nav-btn-back:hover {
      background: #5a6268;
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(108, 117, 125, 0.4);
    }

    .nav-btn-forward {
      background: #007bff;
      color: white;
      box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
    }

    .nav-btn-forward:hover:not(:disabled) {
      background: #0056b3;
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(0, 123, 255, 0.4);
    }

    .nav-btn-forward:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .nav-btn-submit {
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }

    .nav-btn-submit:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4);
    }

    .nav-btn-submit:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .nav-btn-reset {
      background: linear-gradient(135deg, #6b7280, #4b5563);
      color: white;
      box-shadow: 0 4px 12px rgba(107, 114, 128, 0.3);
    }

    .nav-btn-reset:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(107, 114, 128, 0.4);
    }

    /* ============================================
       SURVEY SECTION STYLES
       ============================================ */
    .survey-section {
      background: #f8f9fa;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
    }

    .survey-header {
      text-align: center;
      margin-bottom: 25px;
    }

    .survey-header h1 {
      color: #5A7ED8;
      font-size: 1.8rem;
      margin-bottom: 10px;
    }

    .survey-header p {
      color: #666;
      font-size: 1rem;
    }

    .survey-question {
      margin-bottom: 25px;
    }

    .survey-question-text {
      font-size: 1.1rem;
      font-weight: 600;
      color: #333;
      margin-bottom: 15px;
      line-height: 1.4;
    }

    /* Radio button styling for large tap targets */
    .radio-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .radio-option {
      display: flex;
      align-items: center;
      padding: 12px 16px;
      background: white;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      min-height: 44px; /* Touch-friendly minimum */
    }

    .radio-option:hover {
      border-color: #007bff;
      background: #f0f7ff;
    }

    .radio-option.selected {
      border-color: #007bff;
      background: #e7f1ff;
    }

    .radio-option input[type="radio"] {
      width: 20px;
      height: 20px;
      margin-right: 12px;
      cursor: pointer;
      accent-color: #007bff;
    }

    .radio-option label {
      cursor: pointer;
      font-size: 1rem;
      color: #333;
      flex: 1;
      line-height: 1.4;
    }

    /* Validation message styling */
    .validation-message {
      color: #dc3545;
      font-size: 0.9rem;
      margin-top: 10px;
      display: none;
      padding: 10px;
      background: #fff5f5;
      border-radius: 6px;
      border-left: 3px solid #dc3545;
    }

    .validation-message.show {
      display: block;
    }

    /* ============================================
       FORM STYLES
       ============================================ */
    h1 {
      text-align: center;
      color: #5A7ED8;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 10px;
      font-weight: bold;
      color: #555;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: 1px solid #ccc;
      font-size: 16px;
    }

    /* ============================================
       DASHBOARD & SUMMARY STYLES
       ============================================ */
    .summary-dashboard {
      background: white;
      border-radius: 16px;
      padding: 25px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      border-left: 6px solid #3b82f6;
      margin-top: 20px;
    }

    .dashboard-header {
      text-align: center;
      margin-bottom: 25px;
    }

    .dashboard-title {
      font-size: 20px;
      font-weight: bold;
      color: #333;
      margin: 0;
    }

    .summary-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }

    .summary-card {
      background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
      padding: 18px;
      border-radius: 12px;
      text-align: center;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      border: 1px solid rgba(255,255,255,0.2);
    }

    .summary-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .summary-icon {
      font-size: 24px;
      margin-bottom: 8px;
    }

    .summary-label {
      font-size: 12px;
      color: #666;
      text-transform: uppercase;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .summary-value {
      font-size: 16px;
      font-weight: bold;
      color: #333;
      word-break: break-word;
    }

    /* ============================================
       COVERAGE CARD STYLES
       ============================================ */
    .coverage-main-card {
      background: white;
      border-radius: 16px;
      padding: 25px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      border-left: 6px solid #ddd;
      transition: all 0.3s ease;
      margin-bottom: 20px;
    }

    .coverage-main-card.fully-covered {
      border-left-color: #10b981;
      background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
    }

    .coverage-main-card.partially-covered {
      border-left-color: #f59e0b;
      background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
    }

    .coverage-main-card.no-coverage {
      border-left-color: #ef4444;
      background: linear-gradient(135deg, #fef2f2 0%, #fecaca 100%);
    }

    .coverage-status-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .coverage-title {
      font-size: 20px;
      font-weight: bold;
      color: #333;
    }

    .coverage-badge {
      padding: 8px 16px;
      border-radius: 25px;
      font-size: 14px;
      font-weight: bold;
    }

    .badge-covered {
      background: #10b981;
      color: white;
    }

    .badge-partial {
      background: #f59e0b;
      color: white;
    }

    .badge-no-coverage {
      background: #ef4444;
      color: white;
    }

    .progress-container {
      background: #e5e7eb;
      border-radius: 10px;
      height: 12px;
      margin-bottom: 20px;
      overflow: hidden;
    }

    .progress-bar {
      height: 100%;
      border-radius: 10px;
      transition: width 0.8s ease;
    }

    .progress-covered {
      background: linear-gradient(90deg, #10b981, #34d399);
    }

    .progress-partial {
      background: linear-gradient(90deg, #f59e0b, #fbbf24);
    }

    .coverage-details-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }

    .detail-card {
      background: rgba(255,255,255,0.7);
      padding: 15px;
      border-radius: 12px;
      text-align: center;
      backdrop-filter: blur(10px);
    }

    .detail-icon {
      font-size: 24px;
      margin-bottom: 8px;
    }

    .detail-label {
      font-size: 12px;
      color: #666;
      text-transform: uppercase;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .detail-value {
      font-size: 16px;
      font-weight: bold;
      color: #333;
    }

    /* ============================================
       COUNTRY GRID STYLES
       ============================================ */
    .country-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 10px;
    }

    .country-option {
      border: 2px solid #ccc;
      padding: 10px;
      border-radius: 12px;
      text-align: center;
      cursor: pointer;
    }

    .country-option.selected {
      border-color: #4c51bf;
      background-color: #ebf4ff;
      box-shadow: 0 0 0 3px #a3bffa;
    }

    .country-option:hover {
      background-color: #eef5ff;
      border-color: #667eea;
    }

    .country-option .flag {
      font-size: 32px;
      margin-bottom: 8px;
    }

    /* ============================================
       BUTTON STYLES
       ============================================ */
    .start-family-scenario-btn {
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 25px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
      margin-top: 25px;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }

    .start-family-scenario-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
    }

    .page-header {
      text-align: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 2px solid #e5e7eb;
    }

    .back-button {
      background: linear-gradient(135deg, #6b7280, #4b5563);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-bottom: 20px;
    }

    .back-button:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(107, 114, 128, 0.3);
    }

    /* ============================================
       MOBILE RESPONSIVE STYLES
       ============================================ */
    @media (max-width: 768px) {
      .asean-logo {
        width: 60px;
        top: 6px;
        right: 10px;
      }

      .pidm-nrs2 {
        height: 25px;
        top: 12px;
        left: 10px;
      }

      body {
        padding: 5px;
        align-items: flex-start;
        padding-top: 20px;
      }

      .widget-container {
        margin: 0;
        padding: 20px;
        max-width: 100%;
        width: calc(100% - 10px);
        box-sizing: border-box;
      }

      .landing-container {
        padding: 20px 10px;
      }

      .landing-title {
        font-size: 2.2rem;
      }

      .feature-grid {
        grid-template-columns: 1fr;
        gap: 15px;
      }

      .survey-header h1 {
        font-size: 1.4rem;
      }

      .nav-container {
        flex-direction: column;
        gap: 10px;
      }

      .nav-btn {
        width: 100%;
        justify-content: center;
      }

      .summary-grid {
        grid-template-columns: 1fr;
      }

      .coverage-details-grid {
        grid-template-columns: 1fr;
      }

      .radio-option {
        padding: 14px 16px;
      }

      .radio-option label {
        font-size: 0.95rem;
      }
    }

    /* Extra small screens */
    @media (max-width: 480px) {
      body {
        padding: 2px;
      }

      .widget-container {
        width: calc(100% - 4px);
        padding: 15px;
      }

      .landing-title {
        font-size: 1.8rem;
      }

      .nav-btn {
        padding: 12px 20px;
        font-size: 14px;
      }
    }

    /* Minimum width support (320px) */
    @media (max-width: 320px) {
      .widget-container {
        padding: 10px;
      }

      .survey-section {
        padding: 15px;
        margin: 15px 0;
      }

      .radio-option {
        padding: 10px 12px;
      }

      .survey-question-text {
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>
  <div class="widget-container">
    <!-- ============================================
         PAGE 0: Landing Page
         ============================================ -->
    <div class="page active" id="page0">
      <img src="https://raw.githubusercontent.com/Piperzero/NRS2025/main/asean-logo.png" alt="ASEAN Malaysia 2025" class="asean-logo">
      <img src="https://raw.githubusercontent.com/Piperzero/NRS2025/main/pidm-nrs2.png" alt="PIDM NRS 2025" class="pidm-nrs2">
      <div class="landing-container">
        <div class="landing-header">
          <h1 class="landing-title">ASEAN Coverage Calculator</h1>
          <p class="landing-subtitle">ASEAN+3 Deposit Insurance Protection</p>
          <p class="landing-tagline">Discover how your deposits are protected in 13 jurisdictions</p>
        </div>

        <div class="feature-grid">
          <div class="feature-card">
            <div class="feature-icon">üåç</div>
            <div class="feature-title">13 Jurisdictions</div>
            <div class="feature-description">Comparison of coverage across ASEAN+3 countries</div>
          </div>
          <div class="feature-card">
            <div class="feature-icon">üí∞</div>
            <div class="feature-title">Real-Time Analysis</div>
            <div class="feature-description">Instant calculation with currency conversion and coverage visualisation</div>
          </div>
          <div class="feature-card">
            <div class="feature-icon">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>
            <div class="feature-title">Family Edition</div>
            <div class="feature-description">Strategic distribution through joint accounts</div>
          </div>
        </div>

        <button class="get-started-btn" onclick="startTool()">
          Start Coverage Calculator
        </button>
        <div class="disclaimer-section">
          <h3 class="disclaimer-title">Disclaimer</h3>
          <p class="disclaimer-text">This "ASEAN Coverage Calculator" ("Calculator") is based on certain assumptions (including the currency exchange rates applied which are as of July 2025) and public information. Perbadanan Insurans Deposit Malaysia ("PIDM") makes no representations or warranties as to the accuracy, completeness, and reliability of the information generated by this Calculator. Please contact the deposit insurers from the relevant countries for more information on the deposit insurance in their respective jurisdiction.</p>
          <p class="disclaimer-text">The information generated by this Calculator is for general information only and does not in any way constitute any financial advice, guidance, or recommendation by PIDM. PIDM shall not be responsible for any consequential effect, nor be liable for any loss or damage howsoever caused arising out of of in connection with the use of this Calculator.</p>
        </div>
      </div>
    </div>

    <!-- ============================================
         PAGE 1: Demographics Survey (Q1 - Age Group)
         ============================================ -->
    <div class="page" id="page1">
      <div class="survey-header">
        <h1>Before We Begin - Quick Survey</h1>
        <p>Help us understand our users better</p>
      </div>

      <div class="survey-section">
        <div class="survey-question">
          <p class="survey-question-text">Q1. What is your age group?</p>
          <div class="radio-group" id="q1-options">
            <!-- Radio options generated by JavaScript -->
          </div>
          <div class="validation-message" id="q1-validation">
            Please select your age group to continue.
          </div>
        </div>
      </div>

      <!-- Navigation: Forward only -->
      <div class="nav-container single-btn">
        <button class="nav-btn nav-btn-forward" id="page1-forward" onclick="navigateToPage(2)" disabled>
          Forward ‚Üí
        </button>
      </div>
    </div>

    <!-- ============================================
         PAGE 2: Deposit Amount & Jurisdiction
         ============================================ -->
    <div class="page" id="page2">
      <h1>Deposit Coverage Calculator</h1>

      <!-- Section A: Deposit Amount -->
      <div class="form-group">
        <label for="amount">A. How much money do you wish to keep in a deposit account?</label>
        <input type="number" id="amount" placeholder="Enter amount in MYR (e.g. 10,000)" />
      </div>

      <!-- Section B: Jurisdiction Selector -->
      <div class="form-group">
        <label>B. Which jurisdiction do you wish to keep your deposits in?</label>
        <div class="country-grid" id="countryGrid"></div>
        <div style="margin-top: 15px; font-size: 13px; color: #666; font-style: italic; text-align: center; line-height: 1.4;">
          * Cambodia is currently working on a regulatory framework for a deposit protection scheme.
        </div>
      </div>

      <!-- Deposit Summary Dashboard -->
      <div class="summary">
        <div class="summary-dashboard">
          <div class="dashboard-header">
            <h2 class="dashboard-title">üìã Deposit Summary</h2>
          </div>
          <div class="summary-grid">
            <div class="summary-card">
              <div class="summary-icon">üí∞</div>
              <div class="summary-label">Deposit Amount</div>
              <div class="summary-value" id="summaryAmount">MYR 0.00</div>
            </div>
            <div class="summary-card">
              <div class="summary-icon">üåç</div>
              <div class="summary-label">Selected Jurisdiction</div>
              <div class="summary-value" id="summaryCountry">-</div>
            </div>
            <div class="summary-card">
              <div class="summary-icon">üí±</div>
              <div class="summary-label">Converted Amount</div>
              <div class="summary-value" id="summaryConverted">-</div>
            </div>
            <div class="summary-card">
              <div class="summary-icon">üéØ</div>
              <div class="summary-label">Deposit Insurance Coverage Limit</div>
              <div class="summary-value" id="summaryThreshold">-</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Validation Message -->
      <div class="validation-message" id="page2-validation">
        Please enter a deposit amount and select a jurisdiction to continue.
      </div>

      <!-- Navigation: Back & Forward -->
      <div class="nav-container">
        <button class="nav-btn nav-btn-back" onclick="navigateToPage(1)">
          ‚Üê Back
        </button>
        <button class="nav-btn nav-btn-forward" id="page2-forward" onclick="navigateToPage(3)" disabled>
          Forward ‚Üí
        </button>
      </div>
    </div>

    <!-- ============================================
         PAGE 3: Coverage Results
         ============================================ -->
    <div class="page" id="page3">
      <h1>Your Coverage Across ASEAN</h1>

      <!-- Coverage Box for Selected Jurisdiction -->
      <div class="coverage-box" id="coverageBox">
        <div class="coverage-main-card" id="coverageMainCard">
          <div class="coverage-status-header">
            <div class="coverage-title">üõ°Ô∏è Deposit Insurance Coverage</div>
            <div class="coverage-badge" id="coverageBadge">-</div>
          </div>
          <div class="progress-container">
            <div class="progress-bar" id="progressBar" style="width: 0%;"></div>
          </div>
          <div class="coverage-details-grid">
            <div class="detail-card">
              <div class="detail-icon">üéØ</div>
              <div class="detail-label">Deposit Insurance Coverage Limit</div>
              <div class="detail-value" id="coverageLimit">-</div>
            </div>
            <div class="detail-card">
              <div class="detail-icon">‚ö†Ô∏è</div>
              <div class="detail-label">Uninsured Amount</div>
              <div class="detail-value" id="uncoveredAmount">-</div>
            </div>
          </div>
          <div id="myanmarFootnote" style="display: none; margin-top: 15px; padding-left: 20px; font-size: 13px; color: #666; font-style: italic; line-height: 1.4;">
            * Deposit insurance coverage is 60% of deposits between MMK100,000 to MMK1,000,000.
          </div>
        </div>
      </div>

      <!-- Regional Coverage Comparison Grid -->
      <div class="coverage-box" id="regionalCoverage" style="margin-top: 30px">
        <h2>üåç Regional Coverage Comparison</h2>
        <div id="regionalResults"></div>
      </div>

      <!-- Navigation: Back & Forward -->
      <div class="nav-container">
        <button class="nav-btn nav-btn-back" onclick="navigateToPage(2)">
          ‚Üê Back
        </button>
        <button class="nav-btn nav-btn-forward" onclick="navigateToPage(4)">
          Forward ‚Üí
        </button>
      </div>
    </div>

    <!-- ============================================
         PAGE 4: Behavioral Questions Survey (Q2 & Q3)
         ============================================ -->
    <div class="page" id="page4">
      <div class="survey-header">
        <h1>Understanding Your Confidence</h1>
        <p>Help us understand depositor behavior</p>
      </div>

      <div class="survey-section">
        <!-- Q2: Bank Distress Response -->
        <div class="survey-question">
          <p class="survey-question-text">Q2. If you heard rumors that your bank is in distress/trouble, what would you choose to do?</p>
          <div class="radio-group" id="q2-options">
            <!-- Radio options generated by JavaScript -->
          </div>
          <div class="validation-message" id="q2-validation">
            Please select an answer to continue.
          </div>
        </div>

        <!-- Q3: Withdrawal Behavior -->
        <div class="survey-question" style="margin-top: 30px;">
          <p class="survey-question-text">Q3. If you know your deposits in the bank are protected by the deposit insurance scheme, would you still withdraw all funds or partially withdraw them?</p>
          <div class="radio-group" id="q3-options">
            <!-- Radio options generated by JavaScript -->
          </div>
          <div class="validation-message" id="q3-validation">
            Please select an answer to continue.
          </div>
        </div>
      </div>

      <!-- Navigation: Back & Submit -->
      <div class="nav-container">
        <button class="nav-btn nav-btn-back" onclick="navigateToPage(3)">
          ‚Üê Back
        </button>
        <button class="nav-btn nav-btn-submit" id="page4-submit" onclick="submitSurveyAndContinue()" disabled>
          Submit Survey & Continue ‚Üí
        </button>
      </div>
    </div>

    <!-- ============================================
         PAGE 5: Malaysia Deep Dive (Family Scenario)
         ============================================ -->
    <div class="page" id="page5">
      <div class="page-header">
        <h1>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Let's travel back to Malaysia</h1>
        <p style="color: #666; margin: 10px 0 0 0;">Exploring deposit insurance coverage by PIDM for your family with <strong id="familyAmountDisplay">MYR 0.00</strong></p>
      </div>

      <!-- Malaysia map -->
      <div style="text-align: center; margin: 20px 0;">
        <img src="https://raw.githubusercontent.com/Piperzero/NRS2025/main/my-map.png" alt="Malaysia Map" style="max-width: 50%; height: auto; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
      </div>

      <!-- Step 1 Card -->
      <div class="scenario-step" id="step1Card">
        <div class="summary-card" style="max-width: none; text-align: left; padding: 25px;">
          <div class="summary-icon" style="float: left; margin-right: 15px; margin-bottom: 0;">üå∫</div>
          <div class="scenario-content">
            <h3 style="margin: 0 0 15px 0; color: #333; font-size: 18px;">Step 1: </h3>
            <p style="margin: 0; font-size: 16px; line-height: 1.6; color: #555;">
              You're now in Malaysia. You have <strong style="color: #3b82f6;" id="familyAmount">MYR 0.00</strong> and planning to save in PIDM's member banks.
            </p>
          </div>
        </div>
        <div style="text-align: center; margin-top: 20px;">
          <button onclick="showStep2()" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; border: none; padding: 12px 24px; border-radius: 25px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);">
            Continue to Step 2 ‚Üí
          </button>
        </div>
      </div>

      <!-- Step 2 Card -->
      <div class="scenario-step" id="step2Card" style="display: none;">
        <div class="summary-card" style="max-width: none; text-align: left; padding: 25px;">
          <div class="summary-icon" style="float: left; margin-right: 15px; margin-bottom: 0;">üë•</div>
          <div class="scenario-content">
            <h3 style="margin: 0 0 15px 0; color: #333; font-size: 18px;">Step 2: Family Size</h3>
            <p style="margin: 0 0 20px 0; font-size: 16px; line-height: 1.6; color: #555;">
              How many family members do you have in your household, excluding yourself?
            </p>
            <div class="form-group" style="margin-bottom: 0;">
              <select id="householdMembers" style="width: 100%; padding: 12px; border-radius: 10px; border: 2px solid #e2e8f0; font-size: 16px; background: white; transition: border-color 0.3s ease;">
                <option value="">Select number of family members</option>
                <option value="1">1 family member</option>
                <option value="2">2 family members</option>
                <option value="3">3 family members</option>
              </select>
            </div>
          </div>
        </div>
        <div style="text-align: center; margin-top: 20px;">
          <button id="step2Continue" onclick="showStep3()" disabled style="background: #9ca3af; color: white; border: none; padding: 12px 24px; border-radius: 25px; font-size: 16px; font-weight: 600; cursor: not-allowed; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(156, 163, 175, 0.3);">
            Continue to Step 3 ‚Üí
          </button>
        </div>
      </div>

      <!-- Step 3 Card -->
      <div class="scenario-step" id="step3Card" style="display: none;">
        <div class="summary-card" style="max-width: none; text-align: left; padding: 25px;">
          <div class="summary-icon" style="float: left; margin-right: 15px; margin-bottom: 0;">ü§ù</div>
          <div class="scenario-content">
            <h3 style="margin: 0 0 15px 0; color: #333; font-size: 18px;">Step 3: Joint Account Preference</h3>
            <p style="margin: 0 0 20px 0; font-size: 16px; line-height: 1.6; color: #555;">
              Would you like to open a joint account with each of your family members?
            </p>
            <div class="form-group" style="margin-bottom: 0;">
              <select id="jointAccountChoice" style="width: 100%; padding: 12px; border-radius: 10px; border: 2px solid #e2e8f0; font-size: 16px; background: white; transition: border-color 0.3s ease;">
                <option value="">Select your preference</option>
                <option value="Yes">Yes</option>
                <option value="No">No</option>
              </select>
            </div>
          </div>
        </div>
        <div style="text-align: center; margin-top: 20px;">
          <button id="step3Continue" onclick="showStep4()" disabled style="background: #9ca3af; color: white; border: none; padding: 12px 24px; border-radius: 25px; font-size: 16px; font-weight: 600; cursor: not-allowed; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(156, 163, 175, 0.3);">
            Continue to Step 4 ‚Üí
          </button>
        </div>
      </div>

      <!-- Step 4 Card -->
      <div class="scenario-step" id="step4Card" style="display: none;">
        <div id="step4PathA" class="summary-card" style="max-width: none; text-align: left; padding: 25px; display: none;">
          <div class="summary-icon" style="float: left; margin-right: 15px; margin-bottom: 0;">üí≥</div>
          <div class="scenario-content">
            <h3 style="margin: 0 0 15px 0; color: #333; font-size: 18px;">Step 4: Individual Account Summary</h3>
            <p style="margin: 0 0 20px 0; font-size: 16px; line-height: 1.6; color: #555;" id="individualSummaryText">
              You decided NOT to open joint accounts, instead you open your own deposit account.
            </p>
            <div class="coverage-details-grid" style="margin-top: 20px;">
              <div class="detail-card">
                <div class="detail-icon">üõ°Ô∏è</div>
                <div class="detail-label">Protected Deposits</div>
                <div class="detail-value" id="protectedAmount">MYR 0.00</div>
              </div>
              <div class="detail-card">
                <div class="detail-icon">‚ö†Ô∏è</div>
                <div class="detail-label">Uninsured Amount</div>
                <div class="detail-value" id="uninsuredAmount">MYR 0.00</div>
              </div>
            </div>
          </div>
          <div style="text-align: center; margin-top: 20px;">
            <button onclick="showStep5()" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; border: none; padding: 12px 24px; border-radius: 25px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);">
              Continue to Step 5 ‚Üí
            </button>
          </div>
        </div>

        <div id="step4PathB" class="summary-card" style="max-width: none; text-align: left; padding: 25px; display: none;">
          <div class="summary-icon" style="float: left; margin-right: 15px; margin-bottom: 0;">üìä</div>
          <div class="scenario-content">
            <h3 style="margin: 0 0 15px 0; color: #333; font-size: 18px;">Step 4: Joint Account Distribution</h3>
            <p style="margin: 0 0 20px 0; font-size: 16px; line-height: 1.6; color: #555;">
              Do you want to equally distribute your deposit amount among all your joint accounts?
            </p>
            <div class="form-group" style="margin-bottom: 0;">
              <select id="equalSplitChoice" style="width: 100%; padding: 12px; border-radius: 10px; border: 2px solid #e2e8f0; font-size: 16px; background: white; transition: border-color 0.3s ease;">
                <option value="">Select your preference</option>
                <option value="Yes">Yes</option>
                <option value="No">No</option>
              </select>
            </div>
          </div>
          <div style="text-align: center; margin-top: 20px;">
            <button id="step4Continue" onclick="showStep5()" disabled style="background: #9ca3af; color: white; border: none; padding: 12px 24px; border-radius: 25px; font-size: 16px; font-weight: 600; cursor: not-allowed; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(156, 163, 175, 0.3);">
              Continue to Step 5 ‚Üí
            </button>
          </div>
        </div>
      </div>

      <!-- Step 5 Card -->
      <div class="scenario-step" id="step5Card" style="display: none;">
        <div id="step5PathC" class="summary-card" style="max-width: none; text-align: left; padding: 25px; display: none;">
          <div class="summary-icon" style="float: left; margin-right: 15px; margin-bottom: 0;">‚öñÔ∏è</div>
          <div class="scenario-content">
            <h3 style="margin: 0 0 15px 0; color: #333; font-size: 18px;">Step 5: Equal Split Analysis</h3>
            <p style="margin: 0 0 20px 0; font-size: 16px; line-height: 1.6; color: #555;" id="equalSplitSummaryText">
              You decided to open joint accounts and equally split the deposit amount with each of them.
            </p>
            <div class="summary-dashboard" style="margin-top: 20px;">
              <div class="dashboard-header">
                <h4 style="margin: 0; color: #333;">Deposit Insurance Coverage: Joint Account</h4>
              </div>
              <div id="equalSplitResults" class="summary-grid"></div>
            </div>
          </div>
          <div style="text-align: center; margin-top: 20px;">
            <button onclick="showStep6()" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; border: none; padding: 12px 24px; border-radius: 25px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);">
              Continue to Step 6 ‚Üí
            </button>
          </div>
        </div>

        <div id="step5PathD" class="summary-card" style="max-width: none; text-align: left; padding: 25px; display: none;">
          <div class="summary-icon" style="float: left; margin-right: 15px; margin-bottom: 0;">üìä</div>
          <div class="scenario-content">
            <h3 style="margin: 0 0 15px 0; color: #333; font-size: 18px;">Step 5: Custom Split Allocation</h3>
            <p style="margin: 0 0 20px 0; font-size: 16px; line-height: 1.6; color: #555;">
              Enter the percentage of deposit amount to be placed into each joint account. The total must equal 100%.
            </p>
            <div id="percentageInputs" style="margin-bottom: 20px;"></div>
            <div style="text-align: center; font-size: 14px; color: #666; margin-bottom: 15px;">
              Total: <span id="totalPercentage" style="font-weight: bold; color: #333;">0%</span>
              <span id="percentageStatus" style="margin-left: 10px;"></span>
            </div>
            <div id="unequalSplitResults" style="display: none;">
              <p style="margin: 0 0 20px 0; font-size: 16px; line-height: 1.6; color: #555;" id="unequalSplitSummaryText"></p>
              <div class="summary-dashboard">
                <div class="dashboard-header">
                  <h4 style="margin: 0; color: #333;">Deposit Insurance Coverage: Joint Account</h4>
                </div>
                <div id="unequalSplitResultsGrid" class="summary-grid"></div>
                <div class="detail-card" style="margin-top: 15px; max-width: 300px; margin-left: auto; margin-right: auto;">
                  <div class="detail-icon">‚ö†Ô∏è</div>
                  <div class="detail-label">Total Uninsured Amount</div>
                  <div class="detail-value" id="totalUninsuredAmount">MYR 0.00</div>
                </div>
              </div>
            </div>
          </div>
          <div style="text-align: center; margin-top: 20px;">
            <button id="step5Continue" onclick="showStep6()" disabled style="background: #9ca3af; color: white; border: none; padding: 12px 24px; border-radius: 25px; font-size: 16px; font-weight: 600; cursor: not-allowed; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(156, 163, 175, 0.3);">
              Continue to Step 6 ‚Üí
            </button>
          </div>
        </div>
      </div>

      <!-- Step 6 Card: Final Summary -->
      <div class="scenario-step" id="step6Card" style="display: none;">
        <div class="summary-card" style="max-width: none; text-align: center; padding: 35px;">
          <h3 style="margin: 0 0 25px 0; color: #333; font-size: 24px;">Step 6: Family Deposit Coverage Summary</h3>

          <div class="summary-dashboard" style="margin-bottom: 30px; text-align: left;">
            <div class="dashboard-header">
              <h4 style="margin: 0; color: #333;">üìã Your Deposit Strategy</h4>
            </div>
            <div style="padding: 20px; background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); border-radius: 12px;">
              <div style="margin-bottom: 15px;"><strong>üí∞ Total Deposit Amount:</strong> <span id="finalDepositAmount" style="color: #3b82f6;">MYR 0.00</span></div>
              <div style="margin-bottom: 15px;"><strong>üë• Family Members:</strong> <span id="finalFamilyMembers">0</span></div>
              <div style="margin-bottom: 15px;"><strong>üìà Account Strategy:</strong> <span id="finalAccountStrategy">-</span></div>
              <div style="margin-bottom: 0;"><strong>üìä Distribution Method:</strong> <span id="finalDistribution">-</span></div>
            </div>
          </div>

          <div class="summary-dashboard" style="margin-bottom: 30px; text-align: left;">
            <div class="dashboard-header">
              <h4 style="margin: 0; color: #333;">üõ°Ô∏è Deposit insurance coverage for your family fund</h4>
            </div>
            <div class="summary-grid">
              <div class="summary-card" style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);">
                <div class="summary-icon" style="color: #10b981;">‚úÖ</div>
                <div class="summary-label">Total Protected</div>
                <div class="summary-value" id="finalProtectedAmount">MYR 0.00</div>
              </div>
              <div class="summary-card" style="background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);">
                <div class="summary-icon" style="color: #f59e0b;">‚ö†Ô∏è</div>
                <div class="summary-label">Total Uninsured</div>
                <div class="summary-value" id="finalUninsuredAmount">MYR 0.00</div>
              </div>
            </div>
          </div>

          <div class="summary-dashboard" style="margin-bottom: 30px; text-align: left;">
            <div class="dashboard-header">
              <h4 style="margin: 0; color: #333;">üí° Key Insights</h4>
            </div>
            <div id="finalInsights" style="padding: 20px; background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border-radius: 12px; color: #333; text-align: justify;">
            </div>
          </div>

          <div style="margin-bottom: 30px; padding: 15px; background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%); border-radius: 12px; border-left: 4px solid #3b82f6;">
            <p style="margin: 0; font-size: 14px; color: #555;">
              üìö For more information, please visit us at the NRS ASEAN Booth or <a href="https://www.pidm.gov.my" target="_blank" style="color: #3b82f6; text-decoration: none; font-weight: 600;">www.pidm.gov.my</a>
            </p>
          </div>
        </div>
      </div>

      <!-- Navigation: Back & Reset -->
      <div class="nav-container">
        <button class="nav-btn nav-btn-back" onclick="navigateToPage(4)">
          ‚Üê Back
        </button>
        <button class="nav-btn nav-btn-reset" onclick="resetCalculator()">
          Reset Calculator
        </button>
      </div>
    </div>
  </div>

  <script>
    /* ============================================
       USER & SESSION TRACKING
       ============================================ */

    /**
     * Get or create persistent User ID
     * Stored in localStorage for cross-session tracking
     */
    function getUserId() {
      let userId = localStorage.getItem('depositCalcUserId');
      if (!userId) {
        userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        localStorage.setItem('depositCalcUserId', userId);
      }
      return userId;
    }

    /**
     * Generate new Session ID per page load
     */
    function generateSessionId() {
      return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    }

    // Initialize tracking IDs on page load
    const userId = getUserId();
    const sessionId = generateSessionId();

    /* ============================================
       GLOBAL VARIABLES & STATE
       ============================================ */

    // Current page tracking (0-5)
    let currentPage = 0;

    // Survey answers storage
    const surveyAnswers = {
      age: null,        // Q1: a/b/c/d/e/f
      behavior: null,   // Q2: a/b/c/d
      withdrawal: null  // Q3: a/b/c
    };

    // Selected jurisdiction storage
    let selectedJurisdiction = null;

    // DOM element references
    const amountInput = document.getElementById('amount');
    const summaryAmount = document.getElementById('summaryAmount');
    const summaryCountry = document.getElementById('summaryCountry');
    const summaryThreshold = document.getElementById('summaryThreshold');
    const summaryConverted = document.getElementById('summaryConverted');
    const coverageLimit = document.getElementById('coverageLimit');
    const coverageBadge = document.getElementById('coverageBadge');
    const coverageMainCard = document.getElementById('coverageMainCard');
    const progressBar = document.getElementById('progressBar');
    const uncoveredAmount = document.getElementById('uncoveredAmount');
    const coverageBox = document.getElementById('coverageBox');
    const regionalCoverage = document.getElementById('regionalCoverage');
    const regionalResults = document.getElementById('regionalResults');

    /* ============================================
       COUNTRIES DATA & EXCHANGE RATES
       ============================================ */

    const countries = [
      { name: 'Brunei Darussalam', flag: 'üáßüá≥', limit: 50000, currency: 'BND', code: 'BN' },
      { name: 'Indonesia', flag: 'üáÆüá©', limit: 2000000000, currency: 'IDR', code: 'ID' },
      { name: 'Lao PDR', flag: 'üá±üá¶', limit: 100000000, currency: 'LAK', code: 'LA' },
      { name: 'Malaysia', flag: 'üá≤üáæ', limit: 250000, currency: 'MYR', code: 'MY' },
      { name: 'Myanmar', flag: 'üá≤üá≤', limit: 1000000, currency: 'MMK', code: 'MM' },
      { name: 'Philippines', flag: 'üáµüá≠', limit: 1000000, currency: 'PHP', code: 'PH' },
      { name: 'Singapore', flag: 'üá∏üá¨', limit: 100000, currency: 'SGD', code: 'SG' },
      { name: 'Thailand', flag: 'üáπüá≠', limit: 1000000, currency: 'THB', code: 'TH' },
      { name: 'Viet Nam', flag: 'üáªüá≥', limit: 125000000, currency: 'VND', code: 'VN' },
      { name: "People's Republic of China", flag: 'üá®üá≥', limit: 500000, currency: 'CNY', code: 'CN' },
      { name: 'Japan', flag: 'üáØüáµ', limit: 10000000, currency: 'JPY', code: 'JP' },
      { name: 'Republic of Korea', flag: 'üá∞üá∑', limit: 50000000, currency: 'KRW', code: 'KR' }
    ];

    const exchangeRates = {
      'MYR': 1, 'USD': 0.24, 'SGD': 0.303, 'THB': 7.68, 'IDR': 3834, 'PHP': 13.38,
      'VND': 6157, 'EUR': 0.20, 'GBP': 0.17, 'LAK': 5078, 'MMK': 494,
      'KRW': 326, 'JPY': 35.07, 'CNY': 1.69, 'BND': 0.30
    };

    /* ============================================
       SURVEY QUESTIONS DATA
       ============================================ */

    // Q1: Age group options
    const q1Options = [
      { value: 'a', label: '17 years and younger' },
      { value: 'b', label: '18 - 30 years old' },
      { value: 'c', label: '31 - 45 years old' },
      { value: 'd', label: '46 - 55 years old' },
      { value: 'e', label: '56 - 65 years old' },
      { value: 'f', label: '66 years and older' }
    ];

    // Q2: Bank distress behavior options
    const q2Options = [
      { value: 'a', label: 'Do nothing, as the regulator will ensure everything is resolved.' },
      { value: 'b', label: 'Find information to confirm the news before I decide next steps.' },
      { value: 'c', label: 'Immediately contact the bank and withdraw my funds.' },
      { value: 'd', label: 'Tell everyone and go to the closest physical bank branch.' }
    ];

    // Q3: Withdrawal behavior options
    const q3Options = [
      { value: 'a', label: 'Yes, total withdrawal.' },
      { value: 'b', label: 'Yes, but partial withdrawal.' },
      { value: 'c', label: 'No, leave it be.' }
    ];

    /* ============================================
       UTILITY FUNCTIONS
       ============================================ */

    /**
     * Format a number as currency with specified currency code
     */
    function formatCurrency(value, currency = 'MYR') {
      return currency + ' ' + parseFloat(value).toLocaleString(undefined, {
        minimumFractionDigits: 0,
        maximumFractionDigits: 2
      });
    }

    /* ============================================
       PAGE NAVIGATION FUNCTIONS
       ============================================ */

    /**
     * Navigate to a specific page (0-5)
     * Handles validation before allowing forward navigation
     */
    function navigateToPage(pageNum) {
      // Validate before allowing forward navigation
      if (pageNum > currentPage) {
        if (!validateCurrentPage()) {
          return;
        }
      }

      // Hide current page
      document.getElementById('page' + currentPage).classList.remove('active');

      // Show target page
      document.getElementById('page' + pageNum).classList.add('active');

      // Update current page tracker
      currentPage = pageNum;

      // Scroll to top smoothly
      window.scrollTo({ top: 0, behavior: 'smooth' });

      // Page-specific setup
      if (pageNum === 3) {
        // Recalculate coverage when entering page 3
        updateCoverageDisplay();
      } else if (pageNum === 5) {
        // Setup family scenario page
        setupFamilyScenarioPage();
      }
    }

    /**
     * Validate current page before allowing forward navigation
     */
    function validateCurrentPage() {
      switch (currentPage) {
        case 1:
          // Page 1: Must select age group
          if (!surveyAnswers.age) {
            document.getElementById('q1-validation').classList.add('show');
            return false;
          }
          document.getElementById('q1-validation').classList.remove('show');
          return true;

        case 2:
          // Page 2: Must enter amount AND select jurisdiction
          const amount = parseFloat(amountInput.value);
          if (!amount || amount <= 0 || !selectedJurisdiction) {
            document.getElementById('page2-validation').classList.add('show');
            return false;
          }
          document.getElementById('page2-validation').classList.remove('show');
          return true;

        case 4:
          // Page 4: Must answer Q2 and Q3
          let valid = true;
          if (!surveyAnswers.behavior) {
            document.getElementById('q2-validation').classList.add('show');
            valid = false;
          } else {
            document.getElementById('q2-validation').classList.remove('show');
          }
          if (!surveyAnswers.withdrawal) {
            document.getElementById('q3-validation').classList.add('show');
            valid = false;
          } else {
            document.getElementById('q3-validation').classList.remove('show');
          }
          return valid;

        default:
          return true;
      }
    }

    /**
     * Update forward button state based on validation
     */
    function updateForwardButtonState(pageNum) {
      let buttonId, isValid;

      switch (pageNum) {
        case 1:
          buttonId = 'page1-forward';
          isValid = surveyAnswers.age !== null;
          break;
        case 2:
          buttonId = 'page2-forward';
          const amount = parseFloat(amountInput.value);
          isValid = amount > 0 && selectedJurisdiction !== null;
          break;
        case 4:
          buttonId = 'page4-submit';
          isValid = surveyAnswers.behavior !== null && surveyAnswers.withdrawal !== null;
          break;
        default:
          return;
      }

      const button = document.getElementById(buttonId);
      if (button) {
        button.disabled = !isValid;
      }
    }

    /**
     * Start the tool from landing page
     */
    function startTool() {
      navigateToPage(1);
    }

    /**
     * Reset calculator and return to landing page
     */
    function resetCalculator() {
      // Reset all state
      surveyAnswers.age = null;
      surveyAnswers.behavior = null;
      surveyAnswers.withdrawal = null;
      selectedJurisdiction = null;
      window.depositAmount = null;
      window.householdMembers = null;
      window.jointAccountChoice = null;
      window.equalSplitChoice = null;
      window.customPercentages = null;

      // Reset form inputs
      if (amountInput) amountInput.value = '';

      // Reset country selection
      document.querySelectorAll('.country-option').forEach(el => el.classList.remove('selected'));

      // Reset summary displays
      if (summaryAmount) summaryAmount.textContent = 'MYR 0.00';
      if (summaryCountry) summaryCountry.textContent = '-';
      if (summaryConverted) summaryConverted.textContent = '-';
      if (summaryThreshold) summaryThreshold.textContent = '-';

      // Reset radio button selections
      document.querySelectorAll('.radio-option').forEach(el => el.classList.remove('selected'));
      document.querySelectorAll('.radio-option input[type="radio"]').forEach(el => el.checked = false);

      // Reset validation messages
      document.querySelectorAll('.validation-message').forEach(el => el.classList.remove('show'));

      // Reset forward buttons
      document.getElementById('page1-forward').disabled = true;
      document.getElementById('page2-forward').disabled = true;
      document.getElementById('page4-submit').disabled = true;

      // Reset family scenario steps
      resetFamilyScenarioSteps();

      // Navigate to landing page
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById('page0').classList.add('active');
      currentPage = 0;

      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    /* ============================================
       SURVEY RENDERING & HANDLING
       ============================================ */

    /**
     * Render radio button options for a survey question
     */
    function renderRadioOptions(containerId, options, questionKey) {
      const container = document.getElementById(containerId);
      if (!container) return;

      container.innerHTML = '';

      options.forEach(option => {
        const radioDiv = document.createElement('div');
        radioDiv.className = 'radio-option';
        radioDiv.innerHTML = `
          <input type="radio" id="${questionKey}-${option.value}" name="${questionKey}" value="${option.value}">
          <label for="${questionKey}-${option.value}">${option.label}</label>
        `;

        // Add click handler for the entire option div
        radioDiv.addEventListener('click', function() {
          // Update visual selection
          container.querySelectorAll('.radio-option').forEach(el => el.classList.remove('selected'));
          radioDiv.classList.add('selected');

          // Check the radio button
          const radio = radioDiv.querySelector('input[type="radio"]');
          radio.checked = true;

          // Store the answer
          surveyAnswers[questionKey] = option.value;

          // Update button state
          if (questionKey === 'age') {
            updateForwardButtonState(1);
            document.getElementById('q1-validation').classList.remove('show');
          } else if (questionKey === 'behavior') {
            updateForwardButtonState(4);
            document.getElementById('q2-validation').classList.remove('show');
          } else if (questionKey === 'withdrawal') {
            updateForwardButtonState(4);
            document.getElementById('q3-validation').classList.remove('show');
          }
        });

        container.appendChild(radioDiv);
      });
    }

    /**
     * Initialize all survey questions on page load
     */
    function initializeSurveyQuestions() {
      renderRadioOptions('q1-options', q1Options, 'age');
      renderRadioOptions('q2-options', q2Options, 'behavior');
      renderRadioOptions('q3-options', q3Options, 'withdrawal');
    }

    /* ============================================
       GOOGLE SHEETS SUBMISSION
       ============================================ */

    /**
     * Submit survey data to Google Sheets webhook
     * Called when user clicks "Submit Survey & Continue" on Page 4
     */
    async function submitSurveyData() {
      const webhookUrl = 'https://script.google.com/macros/s/AKfycbzju8K33TgQyN1fD5lAnAnHLDWtGrAGTO8kbFKex0nm6OcoYYCKSDP1VV9L7taW3e3K/exec';

      const payload = {
        userId: userId,
        sessionId: sessionId,
        timestamp: new Date().toISOString(),
        age: surveyAnswers.age,
        behavior: surveyAnswers.behavior,
        withdrawal: surveyAnswers.withdrawal,
        jurisdiction: selectedJurisdiction ? selectedJurisdiction.code : null
      };

      try {
        // Use fetch with no-cors mode for cross-origin POST to Google Apps Script
        await fetch(webhookUrl, {
          method: 'POST',
          mode: 'no-cors',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(payload)
        });
        console.log('Survey data submitted successfully:', payload);
      } catch (error) {
        // Silent failure - log to console but allow user to continue
        console.error('Failed to submit survey data:', error);
      }
    }

    /**
     * Submit survey and navigate to Page 5
     */
    async function submitSurveyAndContinue() {
      // Validate first
      if (!validateCurrentPage()) {
        return;
      }

      // Submit data (non-blocking)
      submitSurveyData();

      // Navigate to Page 5
      navigateToPage(5);
    }

    /* ============================================
       COUNTRY GRID & SELECTION
       ============================================ */

    /**
     * Render the country selection grid
     */
    function renderCountryGrid() {
      const grid = document.getElementById('countryGrid');
      if (!grid) return;

      countries.forEach(country => {
        const div = document.createElement('div');
        div.className = 'country-option';
        div.innerHTML = '<div style="font-weight: bold; margin-bottom: 8px; font-size: 16px;">' + country.name + '</div>';
        div.onclick = () => selectCountry(country, div);
        grid.appendChild(div);
      });
    }

    /**
     * Handle country selection
     */
    function selectCountry(country, element) {
      // Update visual selection
      document.querySelectorAll('.country-option').forEach(el => el.classList.remove('selected'));
      element.classList.add('selected');

      // Store selected jurisdiction
      selectedJurisdiction = country;

      const amount = parseFloat(amountInput.value);
      if (!amount) {
        // Update summary even without amount
        summaryCountry.textContent = country.name;
        summaryThreshold.textContent = formatCurrency(country.limit, country.currency);
        updateForwardButtonState(2);
        return;
      }

      // Calculate and display summary
      const convertedAmount = amount * exchangeRates[country.currency];
      summaryAmount.textContent = formatCurrency(amount, 'MYR');
      summaryCountry.textContent = country.name;
      summaryThreshold.textContent = formatCurrency(country.limit, country.currency);
      summaryConverted.textContent = formatCurrency(convertedAmount, country.currency);

      // Hide validation message
      document.getElementById('page2-validation').classList.remove('show');

      // Update forward button state
      updateForwardButtonState(2);
    }

    /**
     * Update coverage display on Page 3
     */
    function updateCoverageDisplay() {
      if (!selectedJurisdiction) return;

      const country = selectedJurisdiction;
      const amount = parseFloat(amountInput.value);
      if (!amount) return;

      const convertedAmount = amount * exchangeRates[country.currency];
      const limit = country.limit;
      const limitInMYR = country.currency === 'MYR' ? limit : limit / exchangeRates[country.currency];

      const coverageTitle = document.querySelector('.coverage-title');
      if (coverageTitle) {
        coverageTitle.textContent = `üõ°Ô∏è Deposit Insurance Coverage - ${country.name}`;
      }

      let actualCoverage, isFullyCovered, coveragePercentage;

      // Special handling for Myanmar
      if (country.name === 'Myanmar') {
        if (convertedAmount < 100000) {
          actualCoverage = 0;
          isFullyCovered = false;
          coveragePercentage = 0;
        } else if (convertedAmount <= 1000000) {
          const coverageInMMK = convertedAmount * 0.6;
          actualCoverage = coverageInMMK / exchangeRates[country.currency];
          isFullyCovered = false;
          coveragePercentage = 60;
        } else {
          const coverageInMMK = 1000000 * 0.6;
          actualCoverage = coverageInMMK / exchangeRates[country.currency];
          isFullyCovered = false;
          const actualCoveragePercentage = (coverageInMMK / convertedAmount) * 100;
          coveragePercentage = actualCoveragePercentage;
        }
      } else {
        actualCoverage = Math.min(amount, limitInMYR);
        isFullyCovered = amount <= limitInMYR;
        coveragePercentage = Math.min(100, (limitInMYR / amount) * 100);
      }

      // Update coverage limit display
      if (country.currency === 'MYR') {
        coverageLimit.textContent = formatCurrency(limitInMYR, 'MYR');
      } else {
        coverageLimit.textContent = `${formatCurrency(limitInMYR, 'MYR')} (${formatCurrency(limit, country.currency)})`;
      }

      // Update coverage badge and card styling
      if (actualCoverage === 0) {
        coverageBadge.textContent = '‚õî No Coverage';
        coverageBadge.className = 'coverage-badge badge-no-coverage';
        coverageMainCard.className = 'coverage-main-card no-coverage';
        progressBar.style.width = '0%';
      } else if (isFullyCovered) {
        coverageBadge.textContent = '‚úÖ Fully Covered';
        coverageBadge.className = 'coverage-badge badge-covered';
        coverageMainCard.className = 'coverage-main-card fully-covered';
        progressBar.className = 'progress-bar progress-covered';
        progressBar.style.width = '100%';
      } else {
        coverageBadge.textContent = country.name === 'Myanmar' ?
          `üü° 60% Covered` : 'üü° Partially Covered';
        coverageBadge.className = 'coverage-badge badge-partial';
        coverageMainCard.className = 'coverage-main-card partially-covered';
        progressBar.className = 'progress-bar progress-partial';
        progressBar.style.width = coveragePercentage + '%';
      }

      // Calculate and display uninsured amount
      const uninsuredMYR = amount - actualCoverage;
      const uninsuredLocal = uninsuredMYR * exchangeRates[country.currency];

      if (country.currency === 'MYR') {
        uncoveredAmount.textContent = formatCurrency(uninsuredMYR);
      } else {
        uncoveredAmount.textContent = `${formatCurrency(uninsuredMYR)} (${formatCurrency(uninsuredLocal, country.currency)})`;
      }

      // Show/hide Myanmar footnote
      const myanmarFootnote = document.getElementById('myanmarFootnote');
      if (myanmarFootnote) {
        myanmarFootnote.style.display = country.name === 'Myanmar' ? 'block' : 'none';
      }

      // Render regional comparison
      renderRegionalComparison(amount);
    }

    /**
     * Render regional coverage comparison grid
     */
    function renderRegionalComparison(amount) {
      if (!regionalResults) return;

      regionalResults.innerHTML = '';

      const gridContainer = document.createElement('div');
      gridContainer.className = 'country-grid';
      gridContainer.style.marginTop = '15px';

      countries.forEach(country => {
        const limitInMYR = country.currency === 'MYR' ? country.limit : country.limit / exchangeRates[country.currency];
        let isFullyCovered;

        if (country.name === 'Myanmar') {
          const convertedAmount = amount * exchangeRates[country.currency];
          isFullyCovered = false; // Myanmar uses 60% coverage model
        } else {
          isFullyCovered = amount <= limitInMYR;
        }

        const gridItem = document.createElement('div');
        gridItem.className = 'country-option';
        gridItem.style.cursor = 'default';
        gridItem.style.border = isFullyCovered ? '2px solid #10b981' : '2px solid #f59e0b';
        gridItem.style.backgroundColor = isFullyCovered ? '#f0fdf4' : '#fffbeb';

        let statusIcon, statusText;

        if (country.name === 'Myanmar') {
          const convertedAmount = amount * exchangeRates[country.currency];
          if (convertedAmount < 100000 || convertedAmount > 1000000) {
            statusIcon = '‚õî';
            statusText = 'No Coverage';
            gridItem.style.border = '2px solid #ef4444';
            gridItem.style.backgroundColor = '#fef2f2';
          } else {
            statusIcon = 'üü°';
            statusText = '60% Covered';
          }
        } else {
          statusIcon = isFullyCovered ? '‚úÖ' : 'üü°';
          statusText = isFullyCovered ? 'Fully Covered' : 'Partially Covered';
        }

        gridItem.innerHTML = `
          <div style="font-weight: bold; margin-bottom: 8px; font-size: 14px;">${country.name}</div>
          <div style="font-size: 12px; color: ${isFullyCovered ? '#10b981' : (country.name === 'Myanmar' && (amount * exchangeRates[country.currency] < 100000 || amount * exchangeRates[country.currency] > 1000000) ? '#ef4444' : '#f59e0b')}; font-weight: 600;">
            ${statusIcon} ${statusText}
          </div>
        `;

        gridContainer.appendChild(gridItem);
      });

      regionalResults.appendChild(gridContainer);
    }

    /* ============================================
       FAMILY SCENARIO (PAGE 5) FUNCTIONS
       ============================================ */

    /**
     * Setup family scenario page with deposit amount
     */
    function setupFamilyScenarioPage() {
      const amount = parseFloat(amountInput.value) || 0;
      window.depositAmount = amount;

      document.getElementById('familyAmount').textContent = formatCurrency(amount, 'MYR');
      document.getElementById('familyAmountDisplay').textContent = formatCurrency(amount, 'MYR');
    }

    /**
     * Reset family scenario steps to initial state
     */
    function resetFamilyScenarioSteps() {
      document.getElementById('step1Card').style.display = 'block';
      document.getElementById('step2Card').style.display = 'none';
      document.getElementById('step3Card').style.display = 'none';
      document.getElementById('step4Card').style.display = 'none';
      document.getElementById('step5Card').style.display = 'none';
      document.getElementById('step6Card').style.display = 'none';

      const householdSelect = document.getElementById('householdMembers');
      if (householdSelect) householdSelect.value = '';

      const jointSelect = document.getElementById('jointAccountChoice');
      if (jointSelect) jointSelect.value = '';

      const equalSplitSelect = document.getElementById('equalSplitChoice');
      if (equalSplitSelect) equalSplitSelect.value = '';
    }

    function showStep2() {
      document.getElementById('step1Card').style.display = 'none';
      document.getElementById('step2Card').style.display = 'block';

      const householdSelect = document.getElementById('householdMembers');
      householdSelect.replaceWith(householdSelect.cloneNode(true));

      document.getElementById('householdMembers').addEventListener('change', function() {
        const step2Button = document.getElementById('step2Continue');
        if (this.value) {
          step2Button.disabled = false;
          step2Button.style.background = 'linear-gradient(135deg, #3b82f6, #1d4ed8)';
          step2Button.style.cursor = 'pointer';
          step2Button.style.boxShadow = '0 4px 12px rgba(59, 130, 246, 0.3)';
        } else {
          step2Button.disabled = true;
          step2Button.style.background = '#9ca3af';
          step2Button.style.cursor = 'not-allowed';
          step2Button.style.boxShadow = '0 4px 12px rgba(156, 163, 175, 0.3)';
        }
      });
    }

    function showStep3() {
      const householdMembers = document.getElementById('householdMembers').value;
      if (!householdMembers) {
        alert('Please select the number of family members first.');
        return;
      }

      window.householdMembers = parseInt(householdMembers);
      document.getElementById('step2Card').style.display = 'none';
      document.getElementById('step3Card').style.display = 'block';

      const jointSelect = document.getElementById('jointAccountChoice');
      if (jointSelect) {
        jointSelect.replaceWith(jointSelect.cloneNode(true));

        document.getElementById('jointAccountChoice').addEventListener('change', function() {
          const step3Button = document.getElementById('step3Continue');
          if (this.value) {
            step3Button.disabled = false;
            step3Button.style.background = 'linear-gradient(135deg, #3b82f6, #1d4ed8)';
            step3Button.style.cursor = 'pointer';
            step3Button.style.boxShadow = '0 4px 12px rgba(59, 130, 246, 0.3)';
          } else {
            step3Button.disabled = true;
            step3Button.style.background = '#9ca3af';
            step3Button.style.cursor = 'not-allowed';
            step3Button.style.boxShadow = '0 4px 12px rgba(156, 163, 175, 0.3)';
          }
        });
      }
    }

    function showStep4() {
      const jointAccountChoice = document.getElementById('jointAccountChoice').value;
      if (!jointAccountChoice) return;

      window.jointAccountChoice = jointAccountChoice;

      document.getElementById('step3Card').style.display = 'none';
      document.getElementById('step4Card').style.display = 'block';

      if (jointAccountChoice === 'No') {
        document.getElementById('step4PathA').style.display = 'block';
        document.getElementById('step4PathB').style.display = 'none';

        const depositAmount = window.depositAmount || 0;
        const householdMembers = window.householdMembers || 0;
        const malaysiaLimit = 250000;

        const protectedAmount = Math.min(depositAmount, malaysiaLimit);
        const uninsuredAmount = Math.max(0, depositAmount - malaysiaLimit);

        document.getElementById('individualSummaryText').innerHTML =
          'You have <strong style="color: #3b82f6;">' + formatCurrency(depositAmount, 'MYR') + '</strong> and <strong>' + householdMembers + '</strong> family member' + (householdMembers > 1 ? 's' : '') + '. You decided NOT to open joint accounts with them, instead you open your own deposit account.';

        document.getElementById('protectedAmount').textContent = formatCurrency(protectedAmount, 'MYR');
        document.getElementById('uninsuredAmount').textContent = formatCurrency(uninsuredAmount, 'MYR');

      } else {
        document.getElementById('step4PathA').style.display = 'none';
        document.getElementById('step4PathB').style.display = 'block';

        const equalSplitSelect = document.getElementById('equalSplitChoice');
        equalSplitSelect.replaceWith(equalSplitSelect.cloneNode(true));

        document.getElementById('equalSplitChoice').addEventListener('change', function() {
          const step4Button = document.getElementById('step4Continue');
          if (this.value) {
            step4Button.disabled = false;
            step4Button.style.background = 'linear-gradient(135deg, #3b82f6, #1d4ed8)';
            step4Button.style.cursor = 'pointer';
            step4Button.style.boxShadow = '0 4px 12px rgba(59, 130, 246, 0.3)';
          } else {
            step4Button.disabled = true;
            step4Button.style.background = '#9ca3af';
            step4Button.style.cursor = 'not-allowed';
            step4Button.style.boxShadow = '0 4px 12px rgba(156, 163, 175, 0.3)';
          }
        });
      }
    }

    function showStep5() {
      if (window.jointAccountChoice === 'Yes') {
        const equalSplitElement = document.getElementById('equalSplitChoice');
        if (!equalSplitElement || !equalSplitElement.value) {
          alert('Please select your equal split preference first.');
          return;
        }
        window.equalSplitChoice = equalSplitElement.value;
      }

      document.getElementById('step4Card').style.display = 'none';
      document.getElementById('step5Card').style.display = 'block';

      const depositAmount = window.depositAmount || 0;
      const householdMembers = window.householdMembers || 0;
      const malaysiaLimit = 250000;

      if (window.jointAccountChoice === 'No') {
        showStep6();
        return;
      } else if (window.equalSplitChoice === 'Yes') {
        document.getElementById('step5PathC').style.display = 'block';
        document.getElementById('step5PathD').style.display = 'none';

        const summaryText = document.getElementById('equalSplitSummaryText');
        if (summaryText) {
          summaryText.innerHTML =
            'You have <strong style="color: #3b82f6;">' + formatCurrency(depositAmount, 'MYR') + '</strong> and <strong>' + householdMembers + '</strong> family member' + (householdMembers > 1 ? 's' : '') + '. You decided to open joint accounts with each of them, and equally split the deposit amount with each of them.';
        }

        const amountPerAccount = depositAmount / householdMembers;
        const resultsContainer = document.getElementById('equalSplitResults');
        if (resultsContainer) {
          resultsContainer.innerHTML = '';

          for (let i = 1; i <= householdMembers; i++) {
            const depositedAmount = amountPerAccount;
            const protectedAmount = Math.min(amountPerAccount, malaysiaLimit);
            const isFullyCovered = depositedAmount <= malaysiaLimit;
            const coveragePercentage = (protectedAmount / depositedAmount) * 100;
            const coverageStatus = isFullyCovered ? 'Fully Covered (100%)' : `Partially Covered (${coveragePercentage.toFixed(1)}%)`;

            const cardDiv = document.createElement('div');
            cardDiv.className = 'summary-card';
            cardDiv.innerHTML = '<div class="summary-icon">üë•</div><div class="summary-label">Joint Account ' + i + '</div><div style="font-size: 14px; color: #555; margin-bottom: 4px;"><strong>Deposited:</strong> ' + formatCurrency(depositedAmount, 'MYR') + '</div><div style="font-size: 14px; color: #10b981; margin-bottom: 4px;"><strong>Protected:</strong> ' + formatCurrency(protectedAmount, 'MYR') + '</div><div style="font-size: 12px; color: ' + (isFullyCovered ? '#10b981' : '#f59e0b') + '; font-weight: 600;">' + coverageStatus + '</div>';
            resultsContainer.appendChild(cardDiv);
          }
        }

      } else {
        document.getElementById('step5PathC').style.display = 'none';
        document.getElementById('step5PathD').style.display = 'block';

        const inputsContainer = document.getElementById('percentageInputs');
        if (inputsContainer) {
          inputsContainer.innerHTML = '';

          for (let i = 1; i <= householdMembers; i++) {
            const inputDiv = document.createElement('div');
            inputDiv.style.marginBottom = '15px';
            inputDiv.innerHTML = '<label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555;">Joint Account ' + i + ' (%)</label><input type="number" id="percentage' + i + '" min="0" max="100" step="0.1" placeholder="Enter percentage" style="width: 100%; padding: 10px; border-radius: 8px; border: 2px solid #e2e8f0; font-size: 14px;" />';
            inputsContainer.appendChild(inputDiv);
          }

          setTimeout(() => {
            for (let i = 1; i <= householdMembers; i++) {
              const input = document.getElementById('percentage' + i);
              if (input) {
                input.addEventListener('input', updatePercentageTotal);
              }
            }
          }, 100);
        }
      }
    }

    function updatePercentageTotal() {
      const householdMembers = window.householdMembers || 0;
      let total = 0;
      let allFilled = true;

      for (let i = 1; i <= householdMembers; i++) {
        const input = document.getElementById('percentage' + i);
        if (input) {
          const value = parseFloat(input.value) || 0;
          total += value;
          if (!input.value) allFilled = false;
        }
      }

      const totalSpan = document.getElementById('totalPercentage');
      if (totalSpan) {
        totalSpan.textContent = total.toFixed(1) + '%';
      }

      const statusSpan = document.getElementById('percentageStatus');
      const continueButton = document.getElementById('step5Continue');

      if (total === 100 && allFilled) {
        if (statusSpan) statusSpan.innerHTML = '<span style="color: #10b981;">‚úÖ Valid</span>';
        if (continueButton) {
          continueButton.disabled = false;
          continueButton.style.background = 'linear-gradient(135deg, #3b82f6, #1d4ed8)';
          continueButton.style.cursor = 'pointer';
          continueButton.style.boxShadow = '0 4px 12px rgba(59, 130, 246, 0.3)';
        }

        showUnequalSplitResults();
      } else if (total > 100) {
        if (statusSpan) statusSpan.innerHTML = '<span style="color: #ef4444;">‚ùå Too high</span>';
        if (continueButton) {
          continueButton.disabled = true;
          continueButton.style.background = '#9ca3af';
          continueButton.style.cursor = 'not-allowed';
          continueButton.style.boxShadow = '0 4px 12px rgba(156, 163, 175, 0.3)';
        }
        const resultsDiv = document.getElementById('unequalSplitResults');
        if (resultsDiv) resultsDiv.style.display = 'none';
      } else {
        if (statusSpan) statusSpan.innerHTML = '<span style="color: #f59e0b;">‚è≥ Incomplete</span>';
        if (continueButton) {
          continueButton.disabled = true;
          continueButton.style.background = '#9ca3af';
          continueButton.style.cursor = 'not-allowed';
          continueButton.style.boxShadow = '0 4px 12px rgba(156, 163, 175, 0.3)';
        }
        const resultsDiv = document.getElementById('unequalSplitResults');
        if (resultsDiv) resultsDiv.style.display = 'none';
      }
    }

    function showUnequalSplitResults() {
      const depositAmount = window.depositAmount || 0;
      const householdMembers = window.householdMembers || 0;
      const malaysiaLimit = 250000;

      const percentages = [];
      for (let i = 1; i <= householdMembers; i++) {
        const input = document.getElementById('percentage' + i);
        if (input) {
          percentages.push(parseFloat(input.value));
        }
      }

      const percentageText = percentages.map((p, i) => 'Joint Account ' + (i + 1) + ': ' + p + '%').join(', ');
      const summaryTextElement = document.getElementById('unequalSplitSummaryText');
      if (summaryTextElement) {
        summaryTextElement.innerHTML =
          'You have <strong style="color: #3b82f6;">' + formatCurrency(depositAmount, 'MYR') + '</strong> and <strong>' + householdMembers + '</strong> family member' + (householdMembers > 1 ? 's' : '') + '. You decided to open joint accounts with each of them, and the ratios are: ' + percentageText + '.';
      }

      const resultsContainer = document.getElementById('unequalSplitResultsGrid');
      if (resultsContainer) {
        resultsContainer.innerHTML = '';
        let totalUninsured = 0;

        for (let i = 0; i < householdMembers; i++) {
          const accountAmount = (depositAmount * percentages[i]) / 100;
          const protectedAmount = Math.min(accountAmount, malaysiaLimit);
          const uninsuredAmount = Math.max(0, accountAmount - malaysiaLimit);
          const isFullyCovered = accountAmount <= malaysiaLimit;
          const coveragePercentage = (protectedAmount / accountAmount) * 100;
          const coverageStatus = isFullyCovered ? 'Fully Covered (100%)' : `Partially Covered (${coveragePercentage.toFixed(1)}%)`;
          totalUninsured += uninsuredAmount;

          const cardDiv = document.createElement('div');
          cardDiv.className = 'summary-card';
          cardDiv.innerHTML = '<div class="summary-icon">üë•</div><div class="summary-label">Joint Account ' + (i + 1) + '</div><div style="font-size: 14px; color: #555; margin-bottom: 4px;"><strong>Deposited:</strong> ' + formatCurrency(accountAmount, 'MYR') + '</div><div style="font-size: 14px; color: #10b981; margin-bottom: 4px;"><strong>Protected:</strong> ' + formatCurrency(protectedAmount, 'MYR') + '</div><div style="font-size: 12px; color: ' + (isFullyCovered ? '#10b981' : '#f59e0b') + '; font-weight: 600;">' + coverageStatus + '</div>';
          resultsContainer.appendChild(cardDiv);
        }

        const totalUninsuredElement = document.getElementById('totalUninsuredAmount');
        if (totalUninsuredElement) {
          totalUninsuredElement.textContent = formatCurrency(totalUninsured, 'MYR');
        }
      }

      const resultsDiv = document.getElementById('unequalSplitResults');
      if (resultsDiv) {
        resultsDiv.style.display = 'block';
      }
    }

    function showStep6() {
      if (window.jointAccountChoice === 'Yes' && window.equalSplitChoice === 'No') {
        const householdMembers = window.householdMembers || 0;
        const percentages = [];
        for (let i = 1; i <= householdMembers; i++) {
          const input = document.getElementById('percentage' + i);
          if (input) {
            percentages.push(parseFloat(input.value));
          }
        }
        window.customPercentages = percentages;
      }

      const currentCards = ['step4Card', 'step5Card'];
      currentCards.forEach(cardId => {
        const card = document.getElementById(cardId);
        if (card) card.style.display = 'none';
      });

      const step6Card = document.getElementById('step6Card');
      if (step6Card) {
        step6Card.style.display = 'block';
      }

      const depositAmount = window.depositAmount || 0;
      const householdMembers = window.householdMembers || 0;
      const malaysiaLimit = 250000;

      document.getElementById('finalDepositAmount').textContent = formatCurrency(depositAmount, 'MYR');
      document.getElementById('finalFamilyMembers').textContent = householdMembers;

      let accountStrategy, distributionMethod, totalProtected = 0, totalUninsured = 0, insights = '';

      if (window.jointAccountChoice === 'No') {
        accountStrategy = 'Individual deposit account';
        distributionMethod = 'Single account ownership';
        totalProtected = Math.min(depositAmount, malaysiaLimit);
        totalUninsured = Math.max(0, depositAmount - malaysiaLimit);

        insights = `You selected to keep your MYR ${depositAmount.toLocaleString()} in an individual account. ` +
                  (totalUninsured > 0 ?
                    `While MYR ${totalProtected.toLocaleString()} is protected under PIDM coverage, MYR ${totalUninsured.toLocaleString()} exceeded coverage limit.` :
                    `Your entire deposit is fully protected under PIDM coverage.`);

      } else if (window.equalSplitChoice === 'Yes') {
        accountStrategy = `${householdMembers} joint accounts with family members`;
        distributionMethod = 'Equal split distribution';

        const amountPerAccount = depositAmount / householdMembers;
        for (let i = 0; i < householdMembers; i++) {
          const protected = Math.min(amountPerAccount, malaysiaLimit);
          const uninsured = Math.max(0, amountPerAccount - malaysiaLimit);
          totalProtected += protected;
          totalUninsured += uninsured;
        }

        insights = `You distributed MYR ${depositAmount.toLocaleString()} equally across ${householdMembers} joint accounts (${formatCurrency(amountPerAccount, 'MYR')} each). ` + (totalUninsured > 0 ?
                    `Each account has MYR ${Math.min(amountPerAccount, malaysiaLimit).toLocaleString()} protected, with ${formatCurrency(totalUninsured/householdMembers, 'MYR')} uninsured per account.` :
                    `All joint accounts are fully protected under PIDM coverage. `);

      } else {
        accountStrategy = `${householdMembers} joint accounts with family members`;
        const percentageText = window.customPercentages.map((p, i) => `${p}%`).join(', ');
        distributionMethod = `Custom split (${percentageText})`;

        for (let i = 0; i < householdMembers; i++) {
          const accountAmount = (depositAmount * window.customPercentages[i]) / 100;
          const protected = Math.min(accountAmount, malaysiaLimit);
          const uninsured = Math.max(0, accountAmount - malaysiaLimit);
          totalProtected += protected;
          totalUninsured += uninsured;
        }

        insights = `You created a custom distribution across ${householdMembers} joint accounts with ratios of ${percentageText}. ` +
                  (totalUninsured > 0 ?
                    `Your total protected deposit amount is MYR ${totalProtected.toLocaleString()}, with MYR ${totalUninsured.toLocaleString()} exceeded coverage limit.` :
                    `All your joint accounts are fully protected under PIDM coverage.`);
      }

      document.getElementById('finalAccountStrategy').textContent = accountStrategy;
      document.getElementById('finalDistribution').textContent = distributionMethod;
      document.getElementById('finalProtectedAmount').textContent = formatCurrency(totalProtected, 'MYR');
      document.getElementById('finalUninsuredAmount').textContent = formatCurrency(totalUninsured, 'MYR');
      document.getElementById('finalInsights').textContent = insights;
    }

    /* ============================================
       INITIALIZATION
       ============================================ */

    // Initialize country grid
    renderCountryGrid();

    // Initialize survey questions
    initializeSurveyQuestions();

    // Add event listener for amount input
    if (amountInput) {
      amountInput.addEventListener('input', function() {
        const amount = parseFloat(this.value);
        if (amount && amount > 0) {
          summaryAmount.textContent = formatCurrency(amount, 'MYR');

          // Update converted amount if country is selected
          if (selectedJurisdiction) {
            const convertedAmount = amount * exchangeRates[selectedJurisdiction.currency];
            summaryConverted.textContent = formatCurrency(convertedAmount, selectedJurisdiction.currency);
          }

          // Hide validation message
          document.getElementById('page2-validation').classList.remove('show');
        } else {
          summaryAmount.textContent = 'MYR 0.00';
          summaryConverted.textContent = '-';
        }

        // Update forward button state
        updateForwardButtonState(2);
      });
    }

    // Log initialization
    console.log('ASEAN Coverage Calculator initialized');
    console.log('User ID:', userId);
    console.log('Session ID:', sessionId);
  </script>
</body>
</html>
