<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NRS 2025 ASEAN Coverage Calculator</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #8FA5B8 0%, #5A7ED8 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      margin: 0;
      flex-direction: column;
    }
    .widget-container {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      padding: 40px;
      max-width: 700px;
      width: 100%;
      margin: auto;
      position: relative;
      overflow: hidden;
    }
    
    /* Landing Page Styles */
    .landing-container {
      text-align: center;
      padding: 40px 20px;
      min-height: 70vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    
    .landing-header {
      margin-bottom: 40px;
    }
    
    .landing-title {
      font-size: 2.8rem;
      margin-bottom: 15px;
      background: #5A7ED8;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-weight: bold;
    }
    
    .landing-subtitle {
      font-size: 1.3rem;
      color: #555;
      margin-bottom: 10px;
      font-weight: 600;
    }
    
    .landing-tagline {
      font-size: 1rem;
      color: #666;
      margin-bottom: 30px;
    }
    
    .feature-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 25px;
      margin: 30px 0 40px 0;
    }
    
    .feature-card {
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.08);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      border: 1px solid rgba(255,255,255,0.2);
    }
    
    .feature-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.12);
    }
    
    .feature-icon {
      font-size: 2.5rem;
      margin-bottom: 12px;
    }
    
    .feature-title {
      font-size: 1.1rem;
      font-weight: bold;
      color: #333;
      margin-bottom: 8px;
    }
    
    .feature-description {
      font-size: 0.9rem;
      color: #666;
      line-height: 1.4;
    }
    
    .get-started-btn {
      background: #5A7ED8;
      color: white;
      border: none;
      padding: 18px 40px;
      border-radius: 30px;
      font-size: 1.2rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 6px 20px rgba(90, 126, 216, 0.3);
      margin-top: 20px;
    }
    
    .get-started-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
    }
    
    .nrs-badge {
      display: inline-block;
      background: #5A7ED8;
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 20px;
    }
    
    /* Main Page Styles */
    h1 {
      text-align: center;
      color: #333;
    }
    .form-group {
      margin-bottom: 20px;
    }
    .form-group label {
      display: block;
      margin-bottom: 10px;
      font-weight: bold;
      color: #555;
    }
    .form-group input,
    .form-group select {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
    .page {
      display: none;
    }
    .page.active {
      display: block;
    }
    .summary-dashboard {
      background: white;
      border-radius: 16px;
      padding: 25px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      border-left: 6px solid #3b82f6;
      margin-top: 20px;
    }
    .dashboard-header {
      text-align: center;
      margin-bottom: 25px;
    }
    .dashboard-title {
      font-size: 20px;
      font-weight: bold;
      color: #333;
      margin: 0;
    }
    .summary-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }
    .summary-card {
      background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
      padding: 18px;
      border-radius: 12px;
      text-align: center;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      border: 1px solid rgba(255,255,255,0.2);
    }
    .summary-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .summary-icon {
      font-size: 24px;
      margin-bottom: 8px;
    }
    .summary-label {
      font-size: 12px;
      color: #666;
      text-transform: uppercase;
      font-weight: 600;
      margin-bottom: 6px;
    }
    .summary-value {
      font-size: 16px;
      font-weight: bold;
      color: #333;
      word-break: break-word;
    }
    .coverage-main-card {
      background: white;
      border-radius: 16px;
      padding: 25px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      border-left: 6px solid #ddd;
      transition: all 0.3s ease;
      margin-bottom: 20px;
    }
    .coverage-main-card.fully-covered {
      border-left-color: #10b981;
      background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
    }
    .coverage-main-card.partially-covered {
      border-left-color: #f59e0b;
      background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
    }
    .coverage-main-card.no-coverage {
      border-left-color: #ef4444;
      background: linear-gradient(135deg, #fef2f2 0%, #fecaca 100%);
    }
    .coverage-status-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }
    .coverage-title {
      font-size: 20px;
      font-weight: bold;
      color: #333;
    }
    .coverage-badge {
      padding: 8px 16px;
      border-radius: 25px;
      font-size: 14px;
      font-weight: bold;
    }
    .badge-covered {
      background: #10b981;
      color: white;
    }
    .badge-partial {
      background: #f59e0b;
      color: white;
    }
    .badge-no-coverage {
      background: #ef4444;
      color: white;
    }
    .progress-container {
      background: #e5e7eb;
      border-radius: 10px;
      height: 12px;
      margin-bottom: 20px;
      overflow: hidden;
    }
    .progress-bar {
      height: 100%;
      border-radius: 10px;
      transition: width 0.8s ease;
    }
    .progress-covered {
      background: linear-gradient(90deg, #10b981, #34d399);
    }
    .progress-partial {
      background: linear-gradient(90deg, #f59e0b, #fbbf24);
    }
    .coverage-details-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }
    .detail-card {
      background: rgba(255,255,255,0.7);
      padding: 15px;
      border-radius: 12px;
      text-align: center;
      backdrop-filter: blur(10px);
    }
    .detail-icon {
      font-size: 24px;
      margin-bottom: 8px;
    }
    .detail-label {
      font-size: 12px;
      color: #666;
      text-transform: uppercase;
      font-weight: 600;
      margin-bottom: 4px;
    }
    .detail-value {
      font-size: 16px;
      font-weight: bold;
      color: #333;
    }
    .country-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 10px;
    }
    .country-option {
      border: 2px solid #ccc;
      padding: 10px;
      border-radius: 12px;
      text-align: center;
      cursor: pointer;
    }
    .country-option.selected {
      border-color: #4c51bf;
      background-color: #ebf4ff;
      box-shadow: 0 0 0 3px #a3bffa;
    }
    .country-option:hover {
      background-color: #eef5ff;
      border-color: #667eea;
    }
    .country-option .flag {
      font-size: 32px;
      margin-bottom: 8px;
    }
    .start-family-scenario-btn {
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 25px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
      margin-top: 25px;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }
    .start-family-scenario-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
    }
    .page-header {
      text-align: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 2px solid #e5e7eb;
    }
    .back-button {
      background: linear-gradient(135deg, #6b7280, #4b5563);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-bottom: 20px;
    }
    .back-button:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(107, 114, 128, 0.3);
    }
  </style>
</head>
<body>
  <div class="widget-container">
    <!-- PAGE 0: Landing Page -->
    <div class="page active" id="page0">
      <div class="landing-container">
        <div class="landing-header">
          <div class="nrs-badge">ü¶ã NRS 2025 Official Tool</div>
          <h1 class="landing-title">ASEAN Coverage Calculator</h1>
          <p class="landing-subtitle">Deposit Insurance Protection Across ASEAN+3</p>
          <p class="landing-tagline">Discover how your deposits are protected in 12 jurisdictions</p>
        </div>
        
        <div class="feature-grid">
          <div class="feature-card">
            <div class="feature-icon">üåç</div>
            <div class="feature-title">12 Jurisdictions</div>
            <div class="feature-description">Compare coverage across ASEAN+3 countries including special Myanmar rules</div>
          </div>
          <div class="feature-card">
            <div class="feature-icon">üí∞</div>
            <div class="feature-title">Real-Time Analysis</div>
            <div class="feature-description">Instant calculation with currency conversion and coverage visualization</div>
          </div>
          <div class="feature-card">
            <div class="feature-icon">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>
            <div class="feature-title">Family Edition</div>
            <div class="feature-description">Optimize protection through joint accounts and strategic distribution</div>
          </div>
        </div>
        
        <button class="get-started-btn" onclick="startTool()">
          üöÄ Start Calculating Coverage
        </button>
      </div>
    </div>

    <!-- PAGE 1: Main Deposit Insurance Tool -->
    <div class="page" id="page1">
      <h1>ü¶ã Check My ASEAN Coverage Calculator</h1>
      <div class="form-group">
        <label for="amount">A. How much money do you wish to keep in a deposit account?</label>
        <input type="number" id="amount" placeholder="Enter amount in MYR (e.g. 10,000.00)" />
      </div>
      <div class="form-group">
        <label>B. Which jurisdiction do you wish to keep your deposits in?</label>
        <div class="country-grid" id="countryGrid"></div>
        <div style="margin-top: 15px; font-size: 13px; color: #666; font-style: italic; text-align: center; line-height: 1.4;">
          * Cambodia is currently working on a regulatory framework for a deposit protection scheme.
        </div>
      </div>
      <div class="summary">
        <div class="summary-dashboard">
          <div class="dashboard-header">
            <h2 class="dashboard-title">üìã Deposit Summary</h2>
          </div>
          <div class="summary-grid">
            <div class="summary-card">
              <div class="summary-icon">üí∞</div>
              <div class="summary-label">Deposit Amount</div>
              <div class="summary-value" id="summaryAmount">MYR 0.00</div>
            </div>
            <div class="summary-card">
              <div class="summary-icon">üåç</div>
              <div class="summary-label">Selected Jurisdiction</div>
              <div class="summary-value" id="summaryCountry">-</div>
            </div>
            <div class="summary-card">
              <div class="summary-icon">üí±</div>
              <div class="summary-label">Converted Amount</div>
              <div class="summary-value" id="summaryConverted">-</div>
            </div>
            <div class="summary-card">
              <div class="summary-icon">üéØ</div>
              <div class="summary-label">Deposit Insurance Coverage Limit</div>
              <div class="summary-value" id="summaryThreshold">-</div>
            </div>
          </div>
        </div>
      </div>
      <div class="coverage-box" id="coverageBox" style="display: none;">
        <div class="coverage-main-card" id="coverageMainCard">
          <div class="coverage-status-header">
            <div class="coverage-title">üõ°Ô∏è Deposit Insurance Coverage</div>
            <div class="coverage-badge" id="coverageBadge">-</div>
          </div>
          <div class="progress-container">
            <div class="progress-bar" id="progressBar" style="width: 0%;"></div>
          </div>
          <div class="coverage-details-grid">
            <div class="detail-card">
              <div class="detail-icon">üéØ</div>
              <div class="detail-label">Deposit Insurance Coverage Limit</div>
              <div class="detail-value" id="coverageLimit">-</div>
            </div>
            <div class="detail-card">
              <div class="detail-icon">‚ö†Ô∏è</div>
              <div class="detail-label">Uninsured Amount</div>
              <div class="detail-value" id="uncoveredAmount">-</div>
            </div>
          </div>
          <div id="myanmarFootnote" style="display: none; margin-top: 15px; padding-left: 20px; font-size: 13px; color: #666; font-style: italic; line-height: 1.4;">
            * Deposit insurance coverage is 60% of deposits between MMK100,000 to MMK1,000,000.
          </div>
        </div>
      </div>
      <div class="coverage-box" id="regionalCoverage" style="display: none;">
        <h2>üåç Regional Coverage Comparison</h2>
        <div id="regionalResults"></div>
      </div>
      <div class="coverage-box" id="familyScenarioPrompt" style="display: none;">
        <div class="summary-dashboard">
          <div class="dashboard-header">
            <h2 class="dashboard-title">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Ready for Coverage Calculator Family Edition?</h2>
          </div>
          <div class="summary-card" style="max-width: none; text-align: center; padding: 25px;">
            <p style="margin: 0 0 20px 0; font-size: 16px; line-height: 1.6; color: #555;">
              Now let's see how my family is protected by PIDM.
            </p>
            <button class="start-family-scenario-btn" onclick="goToFamilyScenario()">
              Start Family Scenario ‚Üí
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- PAGE 2: Family Deposit Coverage Scenario -->
    <div class="page" id="page2">
      <button class="back-button" onclick="goBackToMain()">‚Üê Back to Main Tool</button>
      <div class="page-header">
        <h1>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Ready for Coverage Calculator: Family Edition</h1>
        <p style="color: #666; margin: 10px 0 0 0;">Exploring deposit insurance coverage for your family with <strong id="familyAmountDisplay">MYR 0.00</strong></p>
      </div>
      
      <div class="scenario-step" id="step1Card">
        <div class="summary-card" style="max-width: none; text-align: left; padding: 25px;">
          <div class="summary-icon" style="float: left; margin-right: 15px; margin-bottom: 0;">üåè</div>
          <div class="scenario-content">
            <h3 style="margin: 0 0 15px 0; color: #333; font-size: 18px;">Step 1: </h3>
            <p style="margin: 0; font-size: 16px; line-height: 1.6; color: #555;">
              You're now in Malaysia and you have <strong style="color: #3b82f6;" id="familyAmount">MYR 0.00</strong> and planning to save in PIDM member banks.
            </p>
          </div>
        </div>
        <div style="text-align: center; margin-top: 20px;">
          <button onclick="showStep2()" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; border: none; padding: 12px 24px; border-radius: 25px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);">
            Continue to Step 2 ‚Üí
          </button>
        </div>
      </div>

      <div class="scenario-step" id="step2Card" style="display: none;">
        <div class="summary-card" style="max-width: none; text-align: left; padding: 25px;">
          <div class="summary-icon" style="float: left; margin-right: 15px; margin-bottom: 0;">üë•</div>
          <div class="scenario-content">
            <h3 style="margin: 0 0 15px 0; color: #333; font-size: 18px;">Step 2: Family Size</h3>
            <p style="margin: 0 0 20px 0; font-size: 16px; line-height: 1.6; color: #555;">
              How many family members do you have in your household, excluding yourself?
            </p>
            <div class="form-group" style="margin-bottom: 0;">
              <select id="householdMembers" style="width: 100%; padding: 12px; border-radius: 10px; border: 2px solid #e2e8f0; font-size: 16px; background: white; transition: border-color 0.3s ease;">
                <option value="">Select number of family members</option>
                <option value="1">1 family member</option>
                <option value="2">2 family members</option>
                <option value="3">3 family members</option>
              </select>
            </div>
          </div>
        </div>
        <div style="text-align: center; margin-top: 20px;">
          <button id="step2Continue" onclick="showStep3()" disabled style="background: #9ca3af; color: white; border: none; padding: 12px 24px; border-radius: 25px; font-size: 16px; font-weight: 600; cursor: not-allowed; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(156, 163, 175, 0.3);">
            Continue to Step 3 ‚Üí
          </button>
        </div>
      </div>

      <div class="scenario-step" id="step3Card" style="display: none;">
        <div class="summary-card" style="max-width: none; text-align: left; padding: 25px;">
          <div class="summary-icon" style="float: left; margin-right: 15px; margin-bottom: 0;">ü§ù</div>
          <div class="scenario-content">
            <h3 style="margin: 0 0 15px 0; color: #333; font-size: 18px;">Step 3: Joint Account Preference</h3>
            <p style="margin: 0 0 20px 0; font-size: 16px; line-height: 1.6; color: #555;">
              Would you like to open a joint account with each of your family members?
            </p>
            <div class="form-group" style="margin-bottom: 0;">
              <select id="jointAccountChoice" style="width: 100%; padding: 12px; border-radius: 10px; border: 2px solid #e2e8f0; font-size: 16px; background: white; transition: border-color 0.3s ease;">
                <option value="">Select your preference</option>
                <option value="Yes">Yes</option>
                <option value="No">No</option>
              </select>
            </div>
          </div>
        </div>
        <div style="text-align: center; margin-top: 20px;">
          <button id="step3Continue" onclick="showStep4()" disabled style="background: #9ca3af; color: white; border: none; padding: 12px 24px; border-radius: 25px; font-size: 16px; font-weight: 600; cursor: not-allowed; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(156, 163, 175, 0.3);">
            Continue to Step 4 ‚Üí
          </button>
        </div>
      </div>

      <div class="scenario-step" id="step4Card" style="display: none;">
        <div id="step4PathA" class="summary-card" style="max-width: none; text-align: left; padding: 25px; display: none;">
          <div class="summary-icon" style="float: left; margin-right: 15px; margin-bottom: 0;">üí≥</div>
          <div class="scenario-content">
            <h3 style="margin: 0 0 15px 0; color: #333; font-size: 18px;">Step 4: Individual Account Summary</h3>
            <p style="margin: 0 0 20px 0; font-size: 16px; line-height: 1.6; color: #555;" id="individualSummaryText">
              You decided NOT to open joint accounts, instead you open your own deposit account.
            </p>
            <div class="coverage-details-grid" style="margin-top: 20px;">
              <div class="detail-card">
                <div class="detail-icon">üõ°Ô∏è</div>
                <div class="detail-label">Protected Deposits</div>
                <div class="detail-value" id="protectedAmount">MYR 0.00</div>
              </div>
              <div class="detail-card">
                <div class="detail-icon">‚ö†Ô∏è</div>
                <div class="detail-label">Uninsured Amount</div>
                <div class="detail-value" id="uninsuredAmount">MYR 0.00</div>
              </div>
            </div>
          </div>
          <div style="text-align: center; margin-top: 20px;">
            <button onclick="showStep5()" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; border: none; padding: 12px 24px; border-radius: 25px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);">
              Continue to Step 5 ‚Üí
            </button>
          </div>
        </div>

        <div id="step4PathB" class="summary-card" style="max-width: none; text-align: left; padding: 25px; display: none;">
          <div class="summary-icon" style="float: left; margin-right: 15px; margin-bottom: 0;">ü§ù</div>
          <div class="scenario-content">
            <h3 style="margin: 0 0 15px 0; color: #333; font-size: 18px;">Step 4: Joint Account Distribution</h3>
            <p style="margin: 0 0 20px 0; font-size: 16px; line-height: 1.6; color: #555;">
              Do you want to equally distribute your deposit amount among all your joint accounts?
            </p>
            <div class="form-group" style="margin-bottom: 0;">
              <select id="equalSplitChoice" style="width: 100%; padding: 12px; border-radius: 10px; border: 2px solid #e2e8f0; font-size: 16px; background: white; transition: border-color 0.3s ease;">
                <option value="">Select your preference</option>
                <option value="Yes">Yes</option>
                <option value="No">No</option>
              </select>
            </div>
          </div>
          <div style="text-align: center; margin-top: 20px;">
            <button id="step4Continue" onclick="showStep5()" disabled style="background: #9ca3af; color: white; border: none; padding: 12px 24px; border-radius: 25px; font-size: 16px; font-weight: 600; cursor: not-allowed; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(156, 163, 175, 0.3);">
              Continue to Step 5 ‚Üí
            </button>
          </div>
        </div>
      </div>

      <div class="scenario-step" id="step5Card" style="display: none;">
        <div id="step5PathC" class="summary-card" style="max-width: none; text-align: left; padding: 25px; display: none;">
          <div class="summary-icon" style="float: left; margin-right: 15px; margin-bottom: 0;">‚öñÔ∏è</div>
          <div class="scenario-content">
            <h3 style="margin: 0 0 15px 0; color: #333; font-size: 18px;">Step 5: Equal Split Analysis</h3>
            <p style="margin: 0 0 20px 0; font-size: 16px; line-height: 1.6; color: #555;" id="equalSplitSummaryText">
              You decided to open joint accounts and equally split the deposit with each of them.
            </p>
            <div class="summary-dashboard" style="margin-top: 20px;">
              <div class="dashboard-header">
                <h4 style="margin: 0; color: #333;">ü¶ã Deposit Insurance Coverage: Joint Account</h4>
              </div>
              <div id="equalSplitResults" class="summary-grid"></div>
            </div>
          </div>
          <div style="text-align: center; margin-top: 20px;">
            <button onclick="showStep6()" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; border: none; padding: 12px 24px; border-radius: 25px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);">
              Continue to Step 6 ‚Üí
            </button>
          </div>
        </div>

        <div id="step5PathD" class="summary-card" style="max-width: none; text-align: left; padding: 25px; display: none;">
          <div class="summary-icon" style="float: left; margin-right: 15px; margin-bottom: 0;">üìä</div>
          <div class="scenario-content">
            <h3 style="margin: 0 0 15px 0; color: #333; font-size: 18px;">Step 5: Custom Split Allocation</h3>
            <p style="margin: 0 0 20px 0; font-size: 16px; line-height: 1.6; color: #555;">
              Enter the percentage of deposit amount to be put into each joint account. The total must equal 100%.
            </p>
            <div id="percentageInputs" style="margin-bottom: 20px;"></div>
            <div style="text-align: center; font-size: 14px; color: #666; margin-bottom: 15px;">
              Total: <span id="totalPercentage" style="font-weight: bold; color: #333;">0%</span>
              <span id="percentageStatus" style="margin-left: 10px;"></span>
            </div>
            <div id="unequalSplitResults" style="display: none;">
              <p style="margin: 0 0 20px 0; font-size: 16px; line-height: 1.6; color: #555;" id="unequalSplitSummaryText"></p>
              <div class="summary-dashboard">
                <div class="dashboard-header">
                  <h4 style="margin: 0; color: #333;">ü¶ã Deposit Insurance Coverage: Joint Account</h4>
                </div>
                <div id="unequalSplitResultsGrid" class="summary-grid"></div>
                <div class="detail-card" style="margin-top: 15px; max-width: 300px; margin-left: auto; margin-right: auto;">
                  <div class="detail-icon">‚ö†Ô∏è</div>
                  <div class="detail-label">Total Uninsured Amount</div>
                  <div class="detail-value" id="totalUninsuredAmount">MYR 0.00</div>
                </div>
              </div>
            </div>
          </div>
          <div style="text-align: center; margin-top: 20px;">
            <button id="step5Continue" onclick="showStep6()" disabled style="background: #9ca3af; color: white; border: none; padding: 12px 24px; border-radius: 25px; font-size: 16px; font-weight: 600; cursor: not-allowed; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(156, 163, 175, 0.3);">
              Continue to Step 6 ‚Üí
            </button>
          </div>
        </div>
      </div>

      <div class="scenario-step" id="step6Card" style="display: none;">
        <div class="summary-card" style="max-width: none; text-align: center; padding: 35px;">
          <div class="summary-icon" style="margin-bottom: 20px; font-size: 48px;">üéØ</div>
          <h3 style="margin: 0 0 25px 0; color: #333; font-size: 24px;">Step 6: Family Deposit Coverage Summary</h3>
          
          <div class="summary-dashboard" style="margin-bottom: 30px; text-align: left;">
            <div class="dashboard-header">
              <h4 style="margin: 0; color: #333;">üìã Your Deposit Strategy</h4>
            </div>
            <div style="padding: 20px; background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); border-radius: 12px;">
              <div style="margin-bottom: 15px;"><strong>üí∞ Total Deposit Amount:</strong> <span id="finalDepositAmount" style="color: #3b82f6;">MYR 0.00</span></div>
              <div style="margin-bottom: 15px;"><strong>üë• Family Members:</strong> <span id="finalFamilyMembers">0</span></div>
              <div style="margin-bottom: 15px;"><strong>ü¶ã Account Strategy:</strong> <span id="finalAccountStrategy">-</span></div>
              <div style="margin-bottom: 0;"><strong>üìä Distribution Method:</strong> <span id="finalDistribution">-</span></div>
            </div>
          </div>

          <div class="summary-dashboard" style="margin-bottom: 30px; text-align: left;">
            <div class="dashboard-header">
              <h4 style="margin: 0; color: #333;">üõ°Ô∏è Deposit insurance coverage for your family fund</h4>
            </div>
            <div class="summary-grid">
              <div class="summary-card" style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);">
                <div class="summary-icon" style="color: #10b981;">‚úÖ</div>
                <div class="summary-label">Total Protected</div>
                <div class="summary-value" id="finalProtectedAmount">MYR 0.00</div>
              </div>
              <div class="summary-card" style="background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);">
                <div class="summary-icon" style="color: #f59e0b;">‚ö†Ô∏è</div>
                <div class="summary-label">Total Uninsured</div>
                <div class="summary-value" id="finalUninsuredAmount">MYR 0.00</div>
              </div>
            </div>
          </div>

          <div class="summary-dashboard" style="margin-bottom: 30px; text-align: left;">
            <div class="dashboard-header">
              <h4 style="margin: 0; color: #333;">üí° Key Insights</h4>
            </div>
            <div id="finalInsights" style="padding: 20px; background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border-radius: 12px; color: #333;">
            </div>
          </div>

          <div style="margin-bottom: 30px; padding: 15px; background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%); border-radius: 12px; border-left: 4px solid #3b82f6;">
            <p style="margin: 0; font-size: 14px; color: #555;">
              üìö For more information, please visit us at the NRS ASEAN Booth or <a href="https://www.pidm.gov.my" target="_blank" style="color: #3b82f6; text-decoration: none; font-weight: 600;">www.pidm.gov.my</a>
            </p>
          </div>

          <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
            <button onclick="startOver()" style="background: linear-gradient(135deg, #10b981, #059669); color: white; border: none; padding: 12px 24px; border-radius: 25px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);">
              üîÑ Start Over From Beginning
            </button>
            <button onclick="goBackToMain()" style="background: linear-gradient(135deg, #6b7280, #4b5563); color: white; border: none; padding: 12px 24px; border-radius: 25px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(107, 114, 128, 0.3);">
              üè† Back to Main Tool
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Global variables
    const amountInput = document.getElementById('amount');
    const summaryAmount = document.getElementById('summaryAmount');
    const summaryCountry = document.getElementById('summaryCountry');
    const summaryThreshold = document.getElementById('summaryThreshold');
    const summaryConverted = document.getElementById('summaryConverted');
    const coverageLimit = document.getElementById('coverageLimit');
    const coverageBadge = document.getElementById('coverageBadge');
    const coverageMainCard = document.getElementById('coverageMainCard');
    const progressBar = document.getElementById('progressBar');
    const uncoveredAmount = document.getElementById('uncoveredAmount');
    const coverageBox = document.getElementById('coverageBox');
    const regionalCoverage = document.getElementById('regionalCoverage');
    const regionalResults = document.getElementById('regionalResults');

    // Countries data
    const countries = [
      { name: 'Brunei Darusallam', flag: 'üáßüá≥', limit: 50000, currency: 'BND' },
      { name: 'Indonesia', flag: 'üáÆüá©', limit: 2000000000, currency: 'IDR' },
      { name: 'Lao PDR', flag: 'üá±üá¶', limit: 100000000, currency: 'LAK' },
      { name: 'Malaysia', flag: 'üá≤üáæ', limit: 250000, currency: 'MYR' },
      { name: 'Myanmar', flag: 'üá≤üá≤', limit: 1000000, currency: 'MMK' },
      { name: 'Philippines', flag: 'üáµüá≠', limit: 1000000, currency: 'PHP' },
      { name: 'Singapore', flag: 'üá∏üá¨', limit: 100000, currency: 'SGD' },
      { name: 'Thailand', flag: 'üáπüá≠', limit: 1000000, currency: 'THB' },
      { name: 'Viet Nam', flag: 'üáªüá≥', limit: 125000000, currency: 'VND' },
      { name: "People's Republic of China", flag: 'üá®üá≥', limit: 500000, currency: 'CNY' },
      { name: 'Japan', flag: 'üáØüáµ', limit: 10000000, currency: 'JPY' },
      { name: 'Republic of Korea', flag: 'üá∞üá∑', limit: 50000000, currency: 'KRW' }
    ];

    // Exchange rates
    const exchangeRates = {
      'MYR': 1, 'USD': 0.24, 'SGD': 0.303, 'THB': 7.68, 'IDR': 3834, 'PHP': 13.38,
      'VND': 6157, 'EUR': 0.20, 'GBP': 0.17, 'LAK': 5078, 'MMK': 494,
      'KRW': 326, 'JPY': 35.07, 'CNY': 1.69, 'BND': 0.30
    };

    // Utility functions
    function formatCurrency(value, currency = 'MYR') {
      return currency + ' ' + parseFloat(value).toLocaleString(undefined, { minimumFractionDigits: 0, maximumFractionDigits: 0 });
    }

    function startTool() {
      document.getElementById('page0').classList.remove('active');
      document.getElementById('page1').classList.add('active');
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function renderCountryGrid() {
      const grid = document.getElementById('countryGrid');
      countries.forEach(country => {
        const div = document.createElement('div');
        div.className = 'country-option';
        div.innerHTML = '<div style="font-weight: bold; margin-bottom: 8px; font-size: 16px;">' + country.name + '</div>';
        div.onclick = () => selectCountry(country, div);
        grid.appendChild(div);
      });
    }

    function selectCountry(country, element) {
      document.querySelectorAll('.country-option').forEach(el => el.classList.remove('selected'));
      element.classList.add('selected');

      const amount = parseFloat(amountInput.value);
      if (!amount) return;

      const convertedAmount = amount * exchangeRates[country.currency];
      summaryAmount.textContent = formatCurrency(amount, 'MYR');
      summaryCountry.textContent = country.name;
      summaryThreshold.textContent = formatCurrency(country.limit, country.currency);
      summaryConverted.textContent = formatCurrency(convertedAmount, country.currency);

      const limit = country.limit;
      const limitInMYR = country.currency === 'MYR' ? limit : limit / exchangeRates[country.currency];
      
      const coverageTitle = document.querySelector('.coverage-title');
      if (coverageTitle) {
        coverageTitle.textContent = `üõ°Ô∏è Deposit Insurance Coverage - ${country.name}`;
      }

      let actualCoverage, isFullyCovered, coveragePercentage;

      if (country.name === 'Myanmar') {
        const convertedAmount = amount * exchangeRates[country.currency];
        
        if (convertedAmount < 100000 || convertedAmount > 1000000) {
          actualCoverage = 0;
          isFullyCovered = false;
          coveragePercentage = 0;
        } else {
          const coverageInMMK = convertedAmount * 0.6;
          actualCoverage = coverageInMMK / exchangeRates[country.currency];
          isFullyCovered = false;
          coveragePercentage = 60;
        }
      } else {
        actualCoverage = Math.min(amount, limitInMYR);
        isFullyCovered = amount <= limitInMYR;
        coveragePercentage = Math.min(100, (limitInMYR / amount) * 100);
      }

      if (country.currency === 'MYR') {
        coverageLimit.textContent = formatCurrency(limitInMYR, 'MYR');
      } else {
        coverageLimit.textContent = `${formatCurrency(limitInMYR, 'MYR')} (${formatCurrency(limit, country.currency)})`;
      }

      if (actualCoverage === 0) {
        coverageBadge.textContent = '‚õî No Coverage';
        coverageBadge.className = 'coverage-badge badge-no-coverage';
        coverageMainCard.className = 'coverage-main-card no-coverage';
        progressBar.style.width = '0%';
      } else if (isFullyCovered) {
        coverageBadge.textContent = '‚úÖ Fully Covered';
        coverageBadge.className = 'coverage-badge badge-covered';
        coverageMainCard.className = 'coverage-main-card fully-covered';
        progressBar.className = 'progress-bar progress-covered';
        progressBar.style.width = '100%';
      } else {
        coverageBadge.textContent = country.name === 'Myanmar' ? 
          `üü° 60% Covered` : 'üü° Partially Covered';
        coverageBadge.className = 'coverage-badge badge-partial';
        coverageMainCard.className = 'coverage-main-card partially-covered';
        progressBar.className = 'progress-bar progress-partial';
        progressBar.style.width = coveragePercentage + '%';
      }

      const uninsuredMYR = amount - actualCoverage;
      const uninsuredLocal = uninsuredMYR * exchangeRates[country.currency];
      
      if (country.currency === 'MYR') {
        uncoveredAmount.textContent = formatCurrency(uninsuredMYR);
      } else {
        uncoveredAmount.textContent = `${formatCurrency(uninsuredMYR)} (${formatCurrency(uninsuredLocal, country.currency)})`;
      }

      coverageBox.style.display = 'block';
      
      // Show/hide Myanmar footnote
      const myanmarFootnote = document.getElementById('myanmarFootnote');
      if (myanmarFootnote) {
        myanmarFootnote.style.display = country.name === 'Myanmar' ? 'block' : 'none';
      }
      
      renderRegionalComparison(amount);
      document.getElementById('familyScenarioPrompt').style.display = 'block';
    }

    function renderRegionalComparison(amount) {
      regionalResults.innerHTML = '';
      
      const gridContainer = document.createElement('div');
      gridContainer.className = 'country-grid';
      gridContainer.style.marginTop = '15px';
      
      countries.forEach(country => {
        const limitInMYR = country.currency === 'MYR' ? country.limit : country.limit / exchangeRates[country.currency];
        let isFullyCovered;

        if (country.name === 'Myanmar') {
          const convertedAmount = amount * exchangeRates[country.currency];
          isFullyCovered = convertedAmount >= 100000 && convertedAmount <= 1000000 ? false : false;
        } else {
          isFullyCovered = amount <= limitInMYR;
        }
        
        const gridItem = document.createElement('div');
        gridItem.className = 'country-option';
        gridItem.style.cursor = 'default';
        gridItem.style.border = isFullyCovered ? '2px solid #10b981' : '2px solid #f59e0b';
        gridItem.style.backgroundColor = isFullyCovered ? '#f0fdf4' : '#fffbeb';
        
        let statusIcon, statusText;
        if (country.name === 'Myanmar') {
          const convertedAmount = amount * exchangeRates[country.currency];
          if (convertedAmount < 100000 || convertedAmount > 1000000) {
            statusIcon = '‚õî';
            statusText = 'No Coverage';
            gridItem.style.border = '2px solid #ef4444';
            gridItem.style.backgroundColor = '#fef2f2';
          } else {
            statusIcon = 'üü°';
            statusText = '60% Covered';
          }
        } else {
          statusIcon = isFullyCovered ? '‚úÖ' : 'üü°';
          statusText = isFullyCovered ? 'Fully Covered' : 'Partially Covered';
        }
        
        gridItem.innerHTML = `
          <div style="font-weight: bold; margin-bottom: 8px; font-size: 14px;">${country.name}</div>
          <div style="font-size: 12px; color: ${isFullyCovered ? '#10b981' : (country.name === 'Myanmar' && (amount * exchangeRates[country.currency] < 100000 || amount * exchangeRates[country.currency] > 1000000) ? '#ef4444' : '#f59e0b')}; font-weight: 600;">
            ${statusIcon} ${statusText}
          </div>
        `;
        
        gridContainer.appendChild(gridItem);
      });
      
      regionalResults.appendChild(gridContainer);
      regionalCoverage.style.display = 'block';
    }

    function goToFamilyScenario() {
      const amount = parseFloat(amountInput.value);
      if (!amount) {
        alert('Please complete Parts A and B first.');
        return;
      }
      
      window.depositAmount = amount;
      document.getElementById('familyAmount').textContent = formatCurrency(amount, 'MYR');
      document.getElementById('familyAmountDisplay').textContent = formatCurrency(amount, 'MYR');
      
      document.getElementById('page1').classList.remove('active');
      document.getElementById('page2').classList.add('active');
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function goBackToMain() {
      window.depositAmount = null;
      window.householdMembers = null;
      window.jointAccountChoice = null;
      window.equalSplitChoice = null;
      window.customPercentages = null;
      
      document.getElementById('step1Card').style.display = 'block';
      document.getElementById('step2Card').style.display = 'none';
      document.getElementById('step3Card').style.display = 'none';
      document.getElementById('step4Card').style.display = 'none';
      document.getElementById('step5Card').style.display = 'none';
      document.getElementById('step6Card').style.display = 'none';
      
      const householdSelect = document.getElementById('householdMembers');
      if (householdSelect) householdSelect.value = '';
      
      const jointSelect = document.getElementById('jointAccountChoice');
      if (jointSelect) jointSelect.value = '';
      
      const equalSplitSelect = document.getElementById('equalSplitChoice');
      if (equalSplitSelect) equalSplitSelect.value = '';
      
      document.getElementById('page2').classList.remove('active');
      document.getElementById('page1').classList.add('active');
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function showStep2() {
      document.getElementById('step1Card').style.display = 'none';
      document.getElementById('step2Card').style.display = 'block';
      
      const householdSelect = document.getElementById('householdMembers');
      householdSelect.replaceWith(householdSelect.cloneNode(true));
      
      document.getElementById('householdMembers').addEventListener('change', function() {
        const step2Button = document.getElementById('step2Continue');
        if (this.value) {
          step2Button.disabled = false;
          step2Button.style.background = 'linear-gradient(135deg, #3b82f6, #1d4ed8)';
          step2Button.style.cursor = 'pointer';
          step2Button.style.boxShadow = '0 4px 12px rgba(59, 130, 246, 0.3)';
        } else {
          step2Button.disabled = true;
          step2Button.style.background = '#9ca3af';
          step2Button.style.cursor = 'not-allowed';
          step2Button.style.boxShadow = '0 4px 12px rgba(156, 163, 175, 0.3)';
        }
      });
    }

    function showStep3() {
      const householdMembers = document.getElementById('householdMembers').value;
      if (!householdMembers) {
        alert('Please select the number of family members first.');
        return;
      }
      
      window.householdMembers = parseInt(householdMembers);
      document.getElementById('step2Card').style.display = 'none';
      document.getElementById('step3Card').style.display = 'block';
      
      const jointSelect = document.getElementById('jointAccountChoice');
      if (jointSelect) {
        jointSelect.replaceWith(jointSelect.cloneNode(true));
        
        document.getElementById('jointAccountChoice').addEventListener('change', function() {
          const step3Button = document.getElementById('step3Continue');
          if (this.value) {
            step3Button.disabled = false;
            step3Button.style.background = 'linear-gradient(135deg, #3b82f6, #1d4ed8)';
            step3Button.style.cursor = 'pointer';
            step3Button.style.boxShadow = '0 4px 12px rgba(59, 130, 246, 0.3)';
          } else {
            step3Button.disabled = true;
            step3Button.style.background = '#9ca3af';
            step3Button.style.cursor = 'not-allowed';
            step3Button.style.boxShadow = '0 4px 12px rgba(156, 163, 175, 0.3)';
          }
        });
      }
    }

    function showStep4() {
      const jointAccountChoice = document.getElementById('jointAccountChoice').value;
      if (!jointAccountChoice) return;
      
      window.jointAccountChoice = jointAccountChoice;
      
      document.getElementById('step3Card').style.display = 'none';
      document.getElementById('step4Card').style.display = 'block';
      
      if (jointAccountChoice === 'No') {
        document.getElementById('step4PathA').style.display = 'block';
        document.getElementById('step4PathB').style.display = 'none';
        
        const depositAmount = window.depositAmount || 0;
        const householdMembers = window.householdMembers || 0;
        const malaysiaLimit = 250000;
        
        const protectedAmount = Math.min(depositAmount, malaysiaLimit);
        const uninsuredAmount = Math.max(0, depositAmount - malaysiaLimit);
        
        document.getElementById('individualSummaryText').innerHTML = 
          'You have <strong style="color: #3b82f6;">' + formatCurrency(depositAmount, 'MYR') + '</strong> and <strong>' + householdMembers + '</strong> family member' + (householdMembers > 1 ? 's' : '') + '. You decided NOT to open joint accounts with them, instead you open your own deposit account.';
        
        document.getElementById('protectedAmount').textContent = formatCurrency(protectedAmount, 'MYR');
        document.getElementById('uninsuredAmount').textContent = formatCurrency(uninsuredAmount, 'MYR');
        
      } else {
        document.getElementById('step4PathA').style.display = 'none';
        document.getElementById('step4PathB').style.display = 'block';
        
        const equalSplitSelect = document.getElementById('equalSplitChoice');
        equalSplitSelect.replaceWith(equalSplitSelect.cloneNode(true));
        
        document.getElementById('equalSplitChoice').addEventListener('change', function() {
          const step4Button = document.getElementById('step4Continue');
          if (this.value) {
            step4Button.disabled = false;
            step4Button.style.background = 'linear-gradient(135deg, #3b82f6, #1d4ed8)';
            step4Button.style.cursor = 'pointer';
            step4Button.style.boxShadow = '0 4px 12px rgba(59, 130, 246, 0.3)';
          } else {
            step4Button.disabled = true;
            step4Button.style.background = '#9ca3af';
            step4Button.style.cursor = 'not-allowed';
            step4Button.style.boxShadow = '0 4px 12px rgba(156, 163, 175, 0.3)';
          }
        });
      }
    }

    function showStep5() {
      if (window.jointAccountChoice === 'Yes') {
        const equalSplitElement = document.getElementById('equalSplitChoice');
        if (!equalSplitElement || !equalSplitElement.value) {
          alert('Please select your equal split preference first.');
          return;
        }
        window.equalSplitChoice = equalSplitElement.value;
      }
      
      document.getElementById('step4Card').style.display = 'none';
      document.getElementById('step5Card').style.display = 'block';
      
      const depositAmount = window.depositAmount || 0;
      const householdMembers = window.householdMembers || 0;
      const malaysiaLimit = 250000;
      
      if (window.jointAccountChoice === 'No') {
        showStep6();
        return;
      } else if (window.equalSplitChoice === 'Yes') {
        document.getElementById('step5PathC').style.display = 'block';
        document.getElementById('step5PathD').style.display = 'none';
        
        const summaryText = document.getElementById('equalSplitSummaryText');
        if (summaryText) {
          summaryText.innerHTML = 
            'You have <strong style="color: #3b82f6;">' + formatCurrency(depositAmount, 'MYR') + '</strong> and <strong>' + householdMembers + '</strong> family member' + (householdMembers > 1 ? 's' : '') + '. You decided to open joint accounts with each of them, and equally split the deposit with each of them.';
        }
        
        const amountPerAccount = depositAmount / householdMembers;
        const resultsContainer = document.getElementById('equalSplitResults');
        if (resultsContainer) {
          resultsContainer.innerHTML = '';
          
          for (let i = 1; i <= householdMembers; i++) {
            const depositedAmount = amountPerAccount;
            const protectedAmount = Math.min(amountPerAccount, malaysiaLimit);
            const isFullyCovered = depositedAmount <= malaysiaLimit;
            const coveragePercentage = (protectedAmount / depositedAmount) * 100;
            const coverageStatus = isFullyCovered ? 'Fully Covered (100%)' : `Partially Covered (${coveragePercentage.toFixed(1)}%)`;
            
            const cardDiv = document.createElement('div');
            cardDiv.className = 'summary-card';
            cardDiv.innerHTML = '<div class="summary-icon">üë•</div><div class="summary-label">Joint Account ' + i + '</div><div style="font-size: 14px; color: #555; margin-bottom: 4px;"><strong>Deposited:</strong> ' + formatCurrency(depositedAmount, 'MYR') + '</div><div style="font-size: 14px; color: #10b981; margin-bottom: 4px;"><strong>Protected:</strong> ' + formatCurrency(protectedAmount, 'MYR') + '</div><div style="font-size: 12px; color: ' + (isFullyCovered ? '#10b981' : '#f59e0b') + '; font-weight: 600;">' + coverageStatus + '</div>';
            resultsContainer.appendChild(cardDiv);
          }
        }
        
      } else {
        document.getElementById('step5PathC').style.display = 'none';
        document.getElementById('step5PathD').style.display = 'block';
        
        const inputsContainer = document.getElementById('percentageInputs');
        if (inputsContainer) {
          inputsContainer.innerHTML = '';
          
          for (let i = 1; i <= householdMembers; i++) {
            const inputDiv = document.createElement('div');
            inputDiv.style.marginBottom = '15px';
            inputDiv.innerHTML = '<label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555;">Joint Account ' + i + ' (%)</label><input type="number" id="percentage' + i + '" min="0" max="100" step="0.1" placeholder="Enter percentage" style="width: 100%; padding: 10px; border-radius: 8px; border: 2px solid #e2e8f0; font-size: 14px;" />';
            inputsContainer.appendChild(inputDiv);
          }
          
          setTimeout(() => {
            for (let i = 1; i <= householdMembers; i++) {
              const input = document.getElementById('percentage' + i);
              if (input) {
                input.addEventListener('input', updatePercentageTotal);
              }
            }
          }, 100);
        }
      }
    }
    
    function updatePercentageTotal() {
      const householdMembers = window.householdMembers || 0;
      let total = 0;
      let allFilled = true;
      
      for (let i = 1; i <= householdMembers; i++) {
        const input = document.getElementById('percentage' + i);
        if (input) {
          const value = parseFloat(input.value) || 0;
          total += value;
          if (!input.value) allFilled = false;
        }
      }
      
      const totalSpan = document.getElementById('totalPercentage');
      if (totalSpan) {
        totalSpan.textContent = total.toFixed(1) + '%';
      }
      
      const statusSpan = document.getElementById('percentageStatus');
      const continueButton = document.getElementById('step5Continue');
      
      if (total === 100 && allFilled) {
        if (statusSpan) statusSpan.innerHTML = '<span style="color: #10b981;">‚úÖ Valid</span>';
        if (continueButton) {
          continueButton.disabled = false;
          continueButton.style.background = 'linear-gradient(135deg, #3b82f6, #1d4ed8)';
          continueButton.style.cursor = 'pointer';
          continueButton.style.boxShadow = '0 4px 12px rgba(59, 130, 246, 0.3)';
        }
        
        showUnequalSplitResults();
      } else if (total > 100) {
        if (statusSpan) statusSpan.innerHTML = '<span style="color: #ef4444;">‚ùå Too high</span>';
        if (continueButton) {
          continueButton.disabled = true;
          continueButton.style.background = '#9ca3af';
          continueButton.style.cursor = 'not-allowed';
          continueButton.style.boxShadow = '0 4px 12px rgba(156, 163, 175, 0.3)';
        }
        const resultsDiv = document.getElementById('unequalSplitResults');
        if (resultsDiv) resultsDiv.style.display = 'none';
      } else {
        if (statusSpan) statusSpan.innerHTML = '<span style="color: #f59e0b;">‚è≥ Incomplete</span>';
        if (continueButton) {
          continueButton.disabled = true;
          continueButton.style.background = '#9ca3af';
          continueButton.style.cursor = 'not-allowed';
          continueButton.style.boxShadow = '0 4px 12px rgba(156, 163, 175, 0.3)';
        }
        const resultsDiv = document.getElementById('unequalSplitResults');
        if (resultsDiv) resultsDiv.style.display = 'none';
      }
    }
    
    function showUnequalSplitResults() {
      const depositAmount = window.depositAmount || 0;
      const householdMembers = window.householdMembers || 0;
      const malaysiaLimit = 250000;
      
      const percentages = [];
      for (let i = 1; i <= householdMembers; i++) {
        const input = document.getElementById('percentage' + i);
        if (input) {
          percentages.push(parseFloat(input.value));
        }
      }
      
      const percentageText = percentages.map((p, i) => 'Joint Account ' + (i + 1) + ': ' + p + '%').join(', ');
      const summaryTextElement = document.getElementById('unequalSplitSummaryText');
      if (summaryTextElement) {
        summaryTextElement.innerHTML = 
          'You have <strong style="color: #3b82f6;">' + formatCurrency(depositAmount, 'MYR') + '</strong> and <strong>' + householdMembers + '</strong> family member' + (householdMembers > 1 ? 's' : '') + '. You decided to open joint accounts with each of them, and the ratios are: ' + percentageText + '.';
      }
      
      const resultsContainer = document.getElementById('unequalSplitResultsGrid');
      if (resultsContainer) {
        resultsContainer.innerHTML = '';
        let totalUninsured = 0;
        
        for (let i = 0; i < householdMembers; i++) {
          const accountAmount = (depositAmount * percentages[i]) / 100;
          const protectedAmount = Math.min(accountAmount, malaysiaLimit);
          const uninsuredAmount = Math.max(0, accountAmount - malaysiaLimit);
          const isFullyCovered = accountAmount <= malaysiaLimit;
          const coveragePercentage = (protectedAmount / accountAmount) * 100;
          const coverageStatus = isFullyCovered ? 'Fully Covered (100%)' : `Partially Covered (${coveragePercentage.toFixed(1)}%)`;
          totalUninsured += uninsuredAmount;
          
          const cardDiv = document.createElement('div');
          cardDiv.className = 'summary-card';
          cardDiv.innerHTML = '<div class="summary-icon">üë•</div><div class="summary-label">Joint Account ' + (i + 1) + '</div><div style="font-size: 14px; color: #555; margin-bottom: 4px;"><strong>Deposited:</strong> ' + formatCurrency(accountAmount, 'MYR') + '</div><div style="font-size: 14px; color: #10b981; margin-bottom: 4px;"><strong>Protected:</strong> ' + formatCurrency(protectedAmount, 'MYR') + '</div><div style="font-size: 12px; color: ' + (isFullyCovered ? '#10b981' : '#f59e0b') + '; font-weight: 600;">' + coverageStatus + '</div>';
          resultsContainer.appendChild(cardDiv);
        }
        
        const totalUninsuredElement = document.getElementById('totalUninsuredAmount');
        if (totalUninsuredElement) {
          totalUninsuredElement.textContent = formatCurrency(totalUninsured, 'MYR');
        }
      }
      
      const resultsDiv = document.getElementById('unequalSplitResults');
      if (resultsDiv) {
        resultsDiv.style.display = 'block';
      }
    }

    function showStep6() {
      if (window.jointAccountChoice === 'Yes' && window.equalSplitChoice === 'No') {
        const householdMembers = window.householdMembers || 0;
        const percentages = [];
        for (let i = 1; i <= householdMembers; i++) {
          const input = document.getElementById('percentage' + i);
          if (input) {
            percentages.push(parseFloat(input.value));
          }
        }
        window.customPercentages = percentages;
      }
      
      const currentCards = ['step4Card', 'step5Card'];
      currentCards.forEach(cardId => {
        const card = document.getElementById(cardId);
        if (card) card.style.display = 'none';
      });
      
      const step6Card = document.getElementById('step6Card');
      if (step6Card) {
        step6Card.style.display = 'block';
      }
      
      const depositAmount = window.depositAmount || 0;
      const householdMembers = window.householdMembers || 0;
      const malaysiaLimit = 250000;
      
      document.getElementById('finalDepositAmount').textContent = formatCurrency(depositAmount, 'MYR');
      document.getElementById('finalFamilyMembers').textContent = householdMembers;
      
      let accountStrategy, distributionMethod, totalProtected = 0, totalUninsured = 0, insights = '';
      
      if (window.jointAccountChoice === 'No') {
        accountStrategy = 'Individual deposit account';
        distributionMethod = 'Single account ownership';
        totalProtected = Math.min(depositAmount, malaysiaLimit);
        totalUninsured = Math.max(0, depositAmount - malaysiaLimit);
        
        insights = `You selected to keep your MYR ${depositAmount.toLocaleString()} in an individual account. ` +
                  (totalUninsured > 0 ? 
                    `While MYR ${totalProtected.toLocaleString()} is protected under PIDM deposit insurance coverage, MYR ${totalUninsured.toLocaleString()} exceeded such limit.` :
                    `Your entire deposit is fully protected under PIDM coverage.`);
                    
      } else if (window.equalSplitChoice === 'Yes') {
        accountStrategy = `${householdMembers} joint accounts with family members`;
        distributionMethod = 'Equal split distribution';
        
        const amountPerAccount = depositAmount / householdMembers;
        for (let i = 0; i < householdMembers; i++) {
          const protected = Math.min(amountPerAccount, malaysiaLimit);
          const uninsured = Math.max(0, amountPerAccount - malaysiaLimit);
          totalProtected += protected;
          totalUninsured += uninsured;
        }
        
        insights = `You distributed MYR ${depositAmount.toLocaleString()} equally across ${householdMembers} joint accounts (MYR ${amountPerAccount.toLocaleString()} each). ` +
                  (totalUninsured > 0 ?
                    `Each account has MYR ${Math.min(amountPerAccount, malaysiaLimit).toLocaleString()} protected, with MYR ${(totalUninsured/householdMembers).toLocaleString()} uninsured per account.` :
                    `All joint accounts are fully protected under PIDM coverage. Do you know - joint accounts enjoy separate deposit insurance protection if names of the join account holders are disclosed?`);
                    
      } else {
        accountStrategy = `${householdMembers} joint accounts with family members`;
        const percentageText = window.customPercentages.map((p, i) => `${p}%`).join(', ');
        distributionMethod = `Custom split (${percentageText})`;
        
        for (let i = 0; i < householdMembers; i++) {
          const accountAmount = (depositAmount * window.customPercentages[i]) / 100;
          const protected = Math.min(accountAmount, malaysiaLimit);
          const uninsured = Math.max(0, accountAmount - malaysiaLimit);
          totalProtected += protected;
          totalUninsured += uninsured;
        }
        
        insights = `You created a custom distribution across ${householdMembers} joint accounts with ratios of ${percentageText}. ` +
                  (totalUninsured > 0 ?
                    `Your total protected deposit amount is MYR ${totalProtected.toLocaleString()}, with MYR ${totalUninsured.toLocaleString()} exceeding deposit coverage limits` :
                    `All your joint accounts are fully protected under PIDM coverage.`);
      }
      
      document.getElementById('finalAccountStrategy').textContent = accountStrategy;
      document.getElementById('finalDistribution').textContent = distributionMethod;
      document.getElementById('finalProtectedAmount').textContent = formatCurrency(totalProtected, 'MYR');
      document.getElementById('finalUninsuredAmount').textContent = formatCurrency(totalUninsured, 'MYR');
      document.getElementById('finalInsights').textContent = insights;
    }
    
    function startOver() {
      window.depositAmount = null;
      window.householdMembers = null;
      window.jointAccountChoice = null;
      window.equalSplitChoice = null;
      window.customPercentages = null;
      
      document.getElementById('page1').classList.remove('active');
      document.getElementById('page2').classList.remove('active');
      document.getElementById('page0').classList.add('active');
      window.scrollTo({ top: 0, behavior: 'smooth' });
      
      if (amountInput) amountInput.value = '';
      document.querySelectorAll('.country-option').forEach(el => el.classList.remove('selected'));
      if (summaryAmount) summaryAmount.textContent = 'MYR 0.00';
      if (summaryCountry) summaryCountry.textContent = '-';
      if (summaryConverted) summaryConverted.textContent = '-';
      if (summaryThreshold) summaryThreshold.textContent = '-';
      if (coverageBox) coverageBox.style.display = 'none';
      if (regionalCoverage) regionalCoverage.style.display = 'none';
      if (document.getElementById('familyScenarioPrompt')) document.getElementById('familyScenarioPrompt').style.display = 'none';
    }

    // Initialize on page load
    renderCountryGrid();

    // Add event listener for amount input to trigger calculations
    if (amountInput) {
      amountInput.addEventListener('input', function() {
        const amount = parseFloat(this.value);
        if (amount && amount > 0) {
          summaryAmount.textContent = formatCurrency(amount, 'MYR');
          
          // Trigger country selection update if a country is already selected
          const selectedCountry = document.querySelector('.country-option.selected');
          if (selectedCountry) {
            const countryName = selectedCountry.textContent.trim();
            const country = countries.find(c => c.name === countryName);
            if (country) {
              selectCountry(country, selectedCountry);
            }
          }
        } else {
          summaryAmount.textContent = 'MYR 0.00';
          if (coverageBox) coverageBox.style.display = 'none';
          if (regionalCoverage) regionalCoverage.style.display = 'none';
          if (document.getElementById('familyScenarioPrompt')) document.getElementById('familyScenarioPrompt').style.display = 'none';
        }
      });
    }
  </script>
</body>
</html>